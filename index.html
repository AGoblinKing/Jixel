<html>
  <head>
    <link type="text/css" rel="stylesheet" href="css/ui-lightness/jquery-ui.css"/>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="jixel.js"></script>
    <script type="text/javascript">
      var game;
      $(function(){
        game = new Jixel($('#can')[0]);
        var am = game.am;
        var mapData =
        "0,0,1,1,1,1,1,1,1,1,0,0,0,0,0\n"+
        "2,3,3,3,3,3,3,3,3,3,3,3,3,3,4\n"+
        "5,6,6,6,6,6,6,6,6,6,6,6,6,6,7";
        
        
        var assets = {
                      'keyboard':['audio','keyboard_cat_remix.mp3'],
                      'cloud':['image', 'cloud.png'],
                      'ship':['image', 'ship.png'],
                      'tiles':['image', 'tilemap.png'],
                      'hit':['audio', 'hit.mp3'],
                      'animals':['image', 'animals.png']
                    };
                     
        game.changeScale(3);
        am.load(assets, function() {
          game.add(new JxlTileMap(0,112).loadMap(game, mapData, am.get('tiles')));
          game.add(new Cloud(am.get('cloud'), 0, 0));
          game.add(new Cloud(am.get('cloud'), 400, 40));
          game.add(new Ship(am.get('ship'), 100,100));
          game.add(new Cat(am.get('animals'), 100, 100));
          
          /*
          for(var i=0;i<500;i++) {
             game.add(new Ship(am.get('ship'), Math.random()*game.width(),Math.random()*game.height()));
          }*/
        
          game.start();
          game.showFPS();
          game.audio.play('keyboard', true, 0, 12.5, .4);
        }, function() {
          //could add loadBar here
        });
        /*
        $(window).resize(function() {
            game.changeScale(Math.floor($(window).height()/game.height()));
        });
        $(window).resize();*/
      });
      
      function LoadBar(count) {
        //Assuming blocks = 5%
        this.display = $('<div/>').addClass('loadBar');
        this.number = number;
        this.numberOfTicks = 20;
        this.mod = 1/this.numberOfTicks;
      }
      LoadBar.prototype.progress = function(count) {
        var num = ((this.number - count)/this.number)%this.mod;
        this.display.empty();
        for(var x=0;x < num;x++) {
          this.display.append($('<div/>').addClass('loadTick'));
        }
      }
      Cat.Inherits(JxlSprite);
      Cat.Override(JxlSprite, 'update');
      function Cat(graphic, x, y) {
        this.JxlSprite(graphic, x, y, 32, 32);
        this.addAnimation('run', [72,73,74,73], 5);
        this.play('run');
      }
      Cat.prototype.update = function(game, time) {
        this.JxlSprite_update(game, time);
        
      }
      Ship.Inherits(JxlSprite);
      function Ship(graphic, x, y) {
        this.JxlSprite(graphic, x, y);
        this.speed = -50;
        this.accel = [0,0];
      }
      Ship.prototype.update = function(game, time) {
        this.angle += 10;
        var mov = [0,0];
        if('W' in game.keys) {
          mov[1] = this.speed;
        } else if ('S' in game.keys) {
          mov[1] = -1*this.speed;
        }
        if ('A' in game.keys) {
          mov[0] = this.speed;
        } else if ('D' in game.keys) {
          mov[0] = -1*this.speed;
        }
        if('SPACE' in game.keys) {
          game.audio.play('hit');
        }
        
        this.move(time, mov);
      }
      Cloud.Inherits(JxlSprite);
      function Cloud(graphic, x, y) {
        this.JxlSprite(graphic, x, y);
        this.dir = 1;
      }
      Cloud.prototype.update = function(game, time) {
        if(this.x+this.asset.width > game.width()) {
          this.dir = -1;
        } else if(this.x < 0) {
          this.dir = 1;
        }
        this.move(time, [50*this.dir,0]);
      }
  
    </script>
    <style type="text/css">
      body {
        background-repeat:repeat;
        background-color:#6ab5f8;
        margin:0px;
        padding:0px;
        overflow:hidden;
      }

      #assets {
        display:none;
      }
    </style>
  </head>
  <body>
    
    <canvas id="can" width="480px" height="320px">
      
    </canvas>
    <div id="assets">
    </div>
  </body>
</html>