<!DOCTYPE html>
<html>
  <head>
    <link type="text/css" rel="stylesheet" href="css/ui-lightness/jquery-ui.css"/>
    <link href='http://fonts.googleapis.com/css?family=Geo' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="jixel.js"></script>
    <script type="text/javascript">
      var game, level, player, cloud;
      $(function(){
        var can = $('<canvas/>')[0];
        can.getContext('2d')
        game = new Jixel(can);
        var am = game.am;
        var mapData =
        "0,0,1,1,1,1,1,1,1,1,0,0,0,0,0\n"+
        "2,3,3,3,3,3,3,3,3,3,3,3,3,3,4\n"+
        "5,6,6,6,6,6,6,6,6,6,6,6,6,6,7";
        
        
        var assets = {
                      'keyboard':['audio','keyboard_cat_remix.mp3'],
                      'cloud':['image', 'cloud.png'],
                      'ship':['image', 'ship.png'],
                      'tiles':['image', 'tilemap.png'],
                      'hit':['audio', 'hit.mp3'],
                      'animals':['image', 'animals.png']
                    };
                     
        game.changeScale(3);
        am.load(assets, function() {
          level = new JxlTileMap(0,112).loadMap(game, mapData, am.get('tiles'));
          game.add(level);
          cloud = new Cloud(am.get('cloud'), 0, 0);
          game.add(cloud);
          game.add(new Cloud(am.get('cloud'), 400, 40));
         /*
          var shipzor = new Ship(am.get('ship'), 100,100);
          game.add(shipzor);*/
         var player = new Cat(am.get('animals'), 100, 100);
          game.add(player);
          game.follow(player);
          
          /*
          for(var i=0;i<500;i++) {
             game.add(new Ship(am.get('ship'), Math.random()*game.width(),Math.random()*game.height()));
          }*/
        
          game.start();
          game.showFPS();
       //  game.audio.play('keyboard', true, 0, 12.5, .4);
         $('body').append(can);
        }, function() {
          //could add loadBar here
        });
        /*
        $(window).resize(function() {
            game.changeScale(Math.floor($(window).height()/game.height()));
        });
        $(window).resize();*/
      });
      
      function LoadBar(count) {
        //Assuming blocks = 5%
        this.display = $('<div/>').addClass('loadBar');
        this.number = number;
        this.numberOfTicks = 20;
        this.mod = 1/this.numberOfTicks;
      }
      LoadBar.prototype.progress = function(count) {
        var num = ((this.number - count)/this.number)%this.mod;
        this.display.empty();
        for(var x=0;x < num;x++) {
          this.display.append($('<div/>').addClass('loadTick'));
        }
      }
      Cat.Inherits(JxlSprite);
      Cat.Override(JxlSprite, 'update');
      function Cat(graphic, x, y) {
        this.JxlSprite(graphic, x, y, 32, 32);
        this.addAnimation('run', [72,73,74,73], .30);
        this.addAnimation('idle', [48,49,50,49], .50);
        this.play('idle');
        this.speed = -80;
        this.drag = new JxlPoint(150,150);
        this.acceleration.y = 500;
      }
      Cat.prototype.update = function(game, time) {
        if ('A' in game.keys) {
          this.velocity.x = this.speed;
          this._flipped = true;
          this.play('run');
        } else if ('D' in game.keys) {
          this._flipped = false;
          this.play('run');
          this.velocity.x = -1*this.speed;
        } else {
          this.play('idle');
        }
        if('SPACE' in game.keys ) {
          this.velocity.y = -150;
        } 
          
        
        this.JxlSprite_update(game, time);
        jxlU.collide(level, this);

        
      }
      Ship.Inherits(JxlSprite);
      Ship.Override(JxlSprite, 'update');
      function Ship(graphic, x, y) {
        this.JxlSprite(graphic, x, y);tech
        this.speed = -50;
      }
      Ship.prototype.update = function(game, time) {
      }
      Cloud.Inherits(JxlSprite);
      function Cloud(graphic, x, y) {
        this.JxlSprite(graphic, x, y);
        this.dir = 1;
        this.velocity.x = -1;
        this.scrollFactor.x = .3;
      }
  
    </script>
    <style type="text/css">
      body {
        background-repeat:repeat;
        background-color:#6ab5f8;
        margin:0px;
        padding:0px;
        overflow:hidden;
        font-family:'Geo';
      }
      .ui-widget {
        font-family:'Geo' !important;
      }
      #assets {
        display:none;
      }
    </style>
  </head>
  <body>
  </body>
</html>