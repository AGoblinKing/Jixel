<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
      <meta name="viewport" content="width=device-width; 
	initial-scale=1; maximum-scale=1; user-scalable=0;"/>
    <link type="text/css" rel="stylesheet" href="../../css/ui-lightness/jquery-ui.css"/>
    
    <link href='http://fonts.googleapis.com/css?family=Geo' rel='stylesheet' type='text/css'/>
    
    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquery-ui.js"></script>
    <script type="text/javascript" src="../../jixel.js"></script>
    <script type="text/javascript">
      var game, am;
      $(function(){
        var can = $('<canvas/>')[0];
        can.getContext('2d')
        game = new Jixel(can);
		game.autoPause = false;
		am = game.am;
		game.toggleFPS();
		game._height($(window).height()/3);
		game._width($(window).width()/3);
        var assets = {
                      'cloud':['image', 'assets/cloud.png'],
                      'autotiles': ['image', 'assets/autotiles.png'],
                      'animals':['image', 'assets/animals.png']
                    };
        game.changeScale(3);
        am.load(assets, function() {
		  $('body').prepend(can);
		  game.state = new TitleScene();
		  game.start();
        }, function() {
          //could add loadBar here
        });
		$(window).resize(function() {
		  game._height($(window).height()/3);
		  game._width($(window).width()/3);
		});
      });
	  TitleScene.Inherits(JxlState);
	  function TitleScene() {
		this.JxlState();
	  }
	  TitleScene.prototype.create = function() {
		// Create four clouds
		maxWidth = game._width() -am.get('cloud').width;
		maxHeight = game._height() - am.get('cloud').height;
		for(var x = 0; x < 6; x++) {
		  this.add(new Cloud(am.get('cloud'), Math.random()*maxWidth, Math.random()*maxHeight));
		}
		this.add(new Cat(am.get('animals'), game._width()/2, game._height()-32));
	  }
      Cloud.Inherits(JxlSprite);
	  Cloud.Override(JxlSprite, 'update');
      function Cloud(graphic, x, y) {
        this.JxlSprite(graphic, x, y);
        this.dir = 1;
		this.solid = false;
        this.velocity.x = -30*Math.random();
		
      }
	  Cloud.prototype.update = function(game, delta) {
		if(this.x < -this.width) this.x = game.width;
		this.JxlSprite_update(game, delta);
	  }
	  Cat.Inherits(JxlSprite);
      Cat.Override(JxlSprite, 'update');
      function Cat(graphic, x, y) {
        this.JxlSprite(graphic, x, y, 32, 32);
        this.addAnimation('run', [72,73,74,73], .30);
        this.play('run');
        this.speed = -80;
      }
  
    </script>
    <style type="text/css">
      body {
        background-repeat:repeat;
        margin:0px;
        padding:0px;
        overflow:hidden;
        font-family:'Geo';
      }
      .ui-widget {
        font-family:'Geo' !important;
      }
      #assets {
        display:none;
      }
    </style>
  </head>
  <body>
    <!--[if lte IE 9]>
    <script type="text/javascript" 
     src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>

    <style>
     .chromeFrameInstallDefaultStyle {
       width: 100%; /* default is 800px */
       border: 5px solid blue;
     }
    </style>

    <div id="prompt"></div>
 
    <script>
     // The conditional ensures that this code will only execute in IE,
     // Therefore we can use the IE-specific attachEvent without worry
     $(function() {
       CFInstall.check({
         mode: "inline", // the default
         node: "prompt"
       });
     });
    </script>
    <![endif]-->
  </body>
</html>