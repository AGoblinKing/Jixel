<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1; user-scalable=0;"/>
    <link type="text/css" rel="stylesheet" href="jixel.css"/>
    <link href='http://fonts.googleapis.com/css?family=Geo' rel='stylesheet' type='text/css'/>
    <script type="text/javascript" src="../lib/mootools-core.js"></script>
    <script type="text/javascript" src="../Jixel/jixel.js"></script>
    <script type="text/javascript" src="../Jixel/ui.js"></script>
    <script type="text/javascript" src="../Jixel/object.js"></script>
    <script type="text/javascript" src="../Jixel/group.js"></script>
    <script type="text/javascript" src="../Jixel/state.js"></script>
    <script type="text/javascript" src="../Jixel/sprite.js"></script>
    <script type="text/javascript" src="../Jixel/tilemap.js"></script>
    <script type="text/javascript" src="../Jixel/audio.js"></script>
    <script type="text/javascript" src="../Jixel/assetmanager.js"></script>
    <script type="text/javascript" src="../Jixel/util.js"></script> 
    <script type="text/javascript">
        var tileData =
"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n"+
"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n"+
"1,1,1,3,3,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1\n"+
"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n"+
"1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1\n"+
"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n"+
"1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,5,1,1,1\n"+
"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1";

        Jxl.init(function() {
            Jxl.loader.load({
                'animals': ['image', 'examples/assets/animals.png'],
                'tiles': ['image', 'examples/assets/tilemap.png']
            }, function() {
                Jxl.state = new GameState();
            });
            Jxl.start();
        });
        
        var GameState = new Class({
           Extends: Jxl.State,
            create: function() {
                this.animal = this.add(new Cat(20, 20));
                this.map = this.add(new Jxl.TileMap({x:0, y:0}).loadMap(tileData, Jxl.loader.get('tiles')));
                this.map.collideIndex = 2;
                Jxl.follow(this.animal);
            },
            update: function(delta) {
                this.parent(delta);
                Jxl.u.collide(this.animal, this.map);
            }
        });
        var Cat = new Class({
            Extends: Jxl.Sprite,
            initialize: function(x, y) {
                this.parent({
                    graphic: Jxl.loader.get('animals'),
                    x: x,
                    y: y,
                    animated: true,
                    width: 32,
                    height: 32,
                    colHullMinus: new Jxl.Point(5, 5)
                });
                this.addAnimation('run', [72,73,74,73], .30);
                this.addAnimation('moveup', [84, 85, 86, 85], .30);
                this.addAnimation('idle', [48,49,50,49], .50);
                this.play('idle');
                this.speed = -80;
                this.drag = new Jxl.Point({x:150,y:150});
            },
            update: function(delta) {
                if (Jxl.keys.A == true) {
                  this.velocity.x = this.speed;
                  this._flipped = true;
                  this.play('run');
                } else if (Jxl.keys.D == true) {
                  this._flipped = false;
                  this.play('run');
                  this.velocity.x = -1*this.speed;
                } else if(Jxl.keys.W) {
                    this.velocity.y = this.speed;
                    this.play('moveup');
                } else if(Jxl.keys.S) {
                    this.velocity.y = -this.speed;
                    this.play('idle');
                } else {
                    this.play('idle');
                }
                this.parent(delta);
            }
        });
    </script>
    <style type="text/css">
      body {
        background-repeat:repeat;
        background-color:#6ab5f8;
        margin:0px;
        padding:0px;
        overflow:hidden;
        font-family:'Geo';
      }
    </style>
  </head>
  <body>
  </body>
</html>