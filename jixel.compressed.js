function generatePath(a){var b=window;a.length!=0&&_(a).each(function(a){b[a]===undefined&&(b[a]={}),b=b[a]});return b}(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new B(a)};typeof module!="undefined"&&module.exports?(module.exports=w,w._=w):a._=w,w.VERSION="1.1.7";var x=w.each=w.forEach=function(a,b,d){if(a!=null)if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(j.call(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=function(a,b,c){var d=[];if(a==null)return d;if(l&&a.map===l)return a.map(b,c);x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(m&&a.reduce===m){d&&(b=w.bind(b,d));return e?a.reduce(b,c):a.reduce(b)}x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){a==null&&(a=[]);if(n&&a.reduceRight===n){d&&(b=w.bind(b,d));return c!==void 0?a.reduceRight(b,c):a.reduceRight(b)}var e=(w.isArray(a)?a.slice():w.toArray(a)).reverse();return w.reduce(e,b,c,d)},w.find=w.detect=function(a,b,c){var d;y(a,function(a,e,f){if(b.call(c,a,e,f)){d=a;return!0}});return d},w.filter=w.select=function(a,b,c){var d=[];if(a==null)return d;if(o&&a.filter===o)return a.filter(b,c);x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d},w.reject=function(a,b,c){var d=[];if(a==null)return d;x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)});return d},w.every=w.all=function(a,b,d){var e=!0;if(a==null)return e;if(p&&a.every===p)return a.every(b,d);x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c});return e};var y=w.some=w.any=function(a,b,d){b=b||w.identity;var e=!1;if(a==null)return e;if(q&&a.some===q)return a.some(b,d);x(a,function(a,f,g){if(e|=b.call(d,a,f,g))return c});return!!e};w.include=w.contains=function(a,b){var c=!1;if(a==null)return c;if(r&&a.indexOf===r)return a.indexOf(b)!=-1;y(a,function(a){if(c=a===b)return!0});return c},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})});return d.value},w.min=function(a,b,c){if(!b&&w.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})});return d.value},w.sortBy=function(a,b,c){return w.pluck(w.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={};x(a,function(a,d){var e=b(a,d);(c[e]||(c[e]=[])).push(a)});return c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?a.toArray?a.toArray():w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):w.values(a):[]},w.size=function(a){return w.toArray(a).length},w.first=w.head=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.last=function(a){return a[a.length-1]},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a){return w.reduce(a,function(a,b){if(w.isArray(b))return a.concat(w.flatten(b));a[a.length]=b;return a},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b){return w.reduce(a,function(a,c,d){if(0==d||(b===!0?w.last(a)!=c:!w.include(a,c)))a[a.length]=c;return a},[])},w.union=function(){return w.uniq(w.flatten(arguments))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a,b){return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c){d=w.sortedIndex(a,b);return a[d]===b?d:-1}if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);while(e<d)f[e++]=a,a+=c;return f},w.bind=function(a,b){if(a.bind===v&&v)return v.apply(a,g.call(arguments,1));var c=g.call(arguments,2);return function(){return a.apply(b,c.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)});return a},w.memoize=function(a,b){var c={};b||(b=w.identity);return function(){var d=b.apply(this,arguments);return j.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))};var z=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};w.throttle=function(a,b){return z(a,b,!1)},w.debounce=function(a,b){return z(a,b,!0)},w.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments));return b.apply(this,c)}},w.compose=function(){var a=g.call(arguments);return function(){var b=g.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)j.call(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){x(g.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])});return a},w.defaults=function(a){x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])});return a},w.clone=function(a){return w.isArray(a)?a.slice():w.extend({},a)},w.tap=function(a,b){b(a);return a},w.isEqual=function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(w.isDate(a)&&w.isDate(b))return a.getTime()===b.getTime();if(w.isNaN(a)&&w.isNaN(b))return!1;if(w.isRegExp(a)&&w.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var e=w.keys(a),f=w.keys(b);if(e.length!=f.length)return!1;for(var g in a)if(!(g in b)||!w.isEqual(a[g],b[g]))return!1;return!0},w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(j.call(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)==="[object Array]"},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return!!a&&!!j.call(a,"callee")},w.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},w.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},w.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1},w.isDate=function(a){return!!(a&&a.getTimezoneOffset&&a.setUTCFullYear)},w.isRegExp=function(a){return!(!(a&&a.test&&a.exec)||!a.ignoreCase&&a.ignoreCase!==!1)},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.noConflict=function(){a._=b;return this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.mixin=function(a){x(w.functions(a),function(b){D(b,w[b]=a[b])})};var A=0;w.uniqueId=function(a){var b=A++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},w.template=function(a,b){var c=w.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj",d);return b?e(b):e};var B=function(a){this._wrapped=a};w.prototype=B.prototype;var C=function(a,b){return b?w(a).chain():a},D=function(a,b){B.prototype[a]=function(){var a=g.call(arguments);h.call(a,this._wrapped);return C(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];B.prototype[a]=function(){b.apply(this._wrapped,arguments);return C(this._wrapped,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];B.prototype[a]=function(){return C(b.apply(this._wrapped,arguments),this._chain)}}),B.prototype.chain=function(){this._chain=!0;return this},B.prototype.value=function(){return this._wrapped}})();var requiredScripts={},reqPath="src/",req=function(a,b){if(a in requiredScripts)b&&b();else{requiredScripts[a]=!0;var c=document.createElement("script");c.src=reqPath+a,src.addEventHandler("load",function(a){b()},!0)}};_.mixin({has:function(a,b,c){if(a[b]!==undefined){c.call(a,a[b]);return!0}},clamp:function(a,b,c){return Math.min(Math.Max(a,b),c)}});var def=function(a,b){var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(){},_(b).has("extend",function(a){c.prototype=new a,c.prototype.constructor=c}),_(b).has("mixins",function(a){_(a).each(function(a){_(c.prototype).extend(a.prototype)})}),_(b).has("statics",function(a){_(c).extend(a)}),_(c.prototype).extend(b);var d=a.split(".");a=d.pop();var e=generatePath(d);b.singleton?e[a]=new c:e[a]=c,_(b).has("alias",function(b){var c=b.split("."),b=c.pop();generatePath(c)[b]=e[a]});return e};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}()),def("Jxl",{singleton:!0,config:function(a){a===undefined&&(a={});var b=this;width=a.width===undefined?240:a.width,height=a.height===undefined?160:a.height,b.canvas=a.canvas!==undefined?a.canvas:document.createElement("canvas"),a.scale!==undefined?b.setScale(a.scale):b.setScale(new Jxl.Point({x:1,y:1})),b.buffer=b.canvas.getContext("2d"),b.showBB=!1,b._width(width),b.state=new Jxl.State,b.audio=new Jxl.Audio,b.mouse=new Jxl.Mouse,b.keys=new Jxl.Keyboard,b._height(height),b.refresh=16,b.running=!1,b.delta=0,b.fullScreen=!1,b.keepResolution=!1,b.date=new Date,b._scrollTarget=new Jxl.Point,b.unfollow(),b.scroll=new Jxl.Point,b.renderedFrames=0,Jxl.Util.setWorldBounds(0,0,this.width,this.height)},follow:function(a,b){b==undefined&&(b=1),this.followTarget=a,this.followLerp=b,this._scrollTarget.x=(this.width>>1)-this.followTarget.x-(this.followTarget.width>>1),this._scrollTarget.y=(this.height>>1)-this.followTarget.y-(this.followTarget.height>>1),this.scroll.x=this._scrollTarget.x,this.scroll.y=this._scrollTarget.y,this.doFollow()},doFollow:function(){this.followTarget!=null&&(this._scrollTarget.x=(this.width>>1)-this.followTarget.x-(this.followTarget.width>>1),this._scrollTarget.y=(this.height>>1)-this.followTarget.y-(this.followTarget.height>>1),this.followLead!=null&&(this._scrollTarget.x-=this.followTarget.velocity.x*this.followLead.x,this._scrollTarget.y-=this.followTarget.velocity.y*this.followLead.y),this.scroll.x+=(this._scrollTarget.x-this.scroll.x)*this.followLerp*Jxl.delta,this.scroll.y+=(this._scrollTarget.y-this.scroll.y)*this.followLerp*Jxl.delta,this.followMin!=null&&(this.scroll.x>this.followMin.x&&(this.scroll.x=this.followMin.x),this.scroll.y>this.followMin.y&&(this.scroll.y=this.followMin.y)),this.followMax!=null&&(this.scroll.x<this.followMax.x&&(this.scroll.x=this.followMax.x),this.scroll.y<this.followMax.y&&(this.scroll.y=this.followMax.y)))},unfollow:function(){this.followTarget=null,this.followLead=null,this.followLerp=1,this.followMin=null,this.followMax=null,this.scroll==null?this.scroll=new Jxl.Point:this.scroll.x=scroll.y=0,this._scrollTarget==null?this._scrollTarget=new Jxl.Point:this._scrollTarget.x=this._scrollTarget.y=0},_width:function(a){a!=undefined&&(this.screenWidth(a*this.scale.x),this.width=Math.floor(a))},_height:function(a){a!=undefined&&(this.screenHeight(a*this.scale.y),this.height=Math.floor(a))},unpause:function(){this.running||(this.running=!0,this.audio.unpause(),this.keys={},this.lastUpdate=new Date,this.UI.pause.destroy())},pause:function(){this.running&&(this.running=!1,this.audio.pause(),this.UI.pause.render(document.body))},screenWidth:function(a){a!=undefined&&(this.canvas.width=a);return this.canvas.width},screenHeight:function(a){a!=undefined&&(this.canvas.height=a);return this.canvas.height},start:function(){var a=this;a.date=new Date,this.lastUpdate=this.date.getTime(),this.running||(this.running=!0,this.interval=setInterval(function(){if(a.running){a.date=new Date;var b=a.date.getTime(),c=(b-a.lastUpdate)/1e3;a.update(c<1?c:0),a.lastUpdate=b}},this.refresh))},setScale:function(a){this.scale=a,this._width(this.width),this._height(this.height)},update:function(a){this.delta=a,this.doFollow(),this.state.update(),this.state.preProcess(),this.state.render(),this.mouse.render(),this.keys.update(),this.audio.update(),this.state.postProcess()}}),def("Jxl.Point",{init:function(a){_(this).extend({x:0,y:0}),this.applyParams(a)},applyParams:function(a){a&&_(this).extend(a)}}),def("Jxl.Rect",{extend:Jxl.Point,init:function(a){Jxl.Point.prototype.init.call(this,a),_(this).extend({width:0,height:0}),this.applyParams(a)},left:function(){return this.x},right:function(){return this.x+this.width},top:function(){return this.y},bottom:function(){return this.y+this.height}}),def("Jxl.Object",{extend:Jxl.Rect,init:function(a){Jxl.Rect.prototype.init.call(this,a),_(this).extend({_point:new Jxl.Point,origin:new Jxl.Point,velocity:new Jxl.Point,acceleration:new Jxl.Point,_pZero:new Jxl.Point,drag:new Jxl.Point,maxVelocity:new Jxl.Point({x:1e4,y:1e4}),scrollFactor:new Jxl.Point({x:1,y:1}),colHullX:new Jxl.Rect,colHullY:new Jxl.Rect,colVector:new Jxl.Point,colOffsets:[new Jxl.Point],colHullMinus:new Jxl.Point,border:{visible:!1,thickness:2,color:"#f00"},collideLeft:!0,collideRight:!0,collideTop:!0,collideBottom:!0,angle:0,angularVelocity:0,angularDrag:0,angularAcceleration:0,maxAngular:1e4,thrust:0,exists:!0,visible:!0,active:!0,solid:!0,fixed:!1,moves:!0,health:1,dead:!1,_flicker:!1,_flickerTimer:-1,_group:!1}),this.applyParams(a)},refreshHulls:function(){var a=this.colHullMinus.x,b=this.colHullMinus.y;this.colHullX.x=this.x+a,this.colHullX.y=this.y+b,this.colHullX.width=this.width-a,this.colHullX.height=this.height-b,this.colHullY.x=this.x+a,this.colHullY.y=this.y+a,this.colHullY.width=this.width-a,this.colHullY.height=this.height-a},updateMotion:function(){if(!!this.moves){this.solid&&this.refreshHulls(),this.onFloor=!1;var a=(Jxl.Util.computeVelocity(this.angularVelocity,this.angularAcceleration,this.angularDrag,this.maxAngular)-this.angularVelocity)/2;this.angularVelocity+=a,this.angle+=this.angularVelocity*Jxl.delta,this.angularVelocity+=a;var b;if(this.thrust!=0){b=Jxl.Util.rotatePoint(-this.thrust,0,0,0,this.angle);var c=Jxl.Util.rotatePoint(-this.maxThrust,0,0,0,this.angle),d=Math.abs(c.x);d>Math.abs(c.y)?c.y=d:d=Math.abs(c.y),this.maxVelocity.x=this.maxVelocity.y=Math.abs(d)}else b=this._pZero;a=(Jxl.Util.computeVelocity(this.velocity.x,this.acceleration.x+b.x,this.drag.x,this.maxVelocity.x)-this.velocity.x)/2,this.velocity.x+=a;var e=this.velocity.x*Jxl.delta;this.velocity.x+=a,a=(Jxl.Util.computeVelocity(this.velocity.y,this.acceleration.y+b.y,this.drag.y,this.maxVelocity.y)-this.velocity.y)/2,this.velocity.y+=a;var f=this.velocity.y*Jxl.delta;this.velocity.y+=a,this.x+=e,this.y+=f;if(!this.solid)return;this.colVector.x=e,this.colVector.y=f,this.colHullX.width+=Math.abs(e),this.colVector.x<0&&(this.colHullX.x+=this.colVector.x),this.colHullY.x=this.x,this.colHullY.height+=Math.abs(this.colVector.y),this.colVector.y<0&&(this.colHullY.y+=this.colVector.y)}},updateFlickering:function(){this.flickering()&&(this._flickerTimer>0&&(this._flickerTimer-=Jxl.delta,this._flickerTimer==0&&(this._flickerTimer=-1)),this._flickerTimer<0?this.flicker(-1):(this._flicker=!this._flicker,this.visible=!this._flicker))},update:function(){this.updateMotion(),this.updateFlickering()},flicker:function(a){a==undefined&&(a=1),this._flickerTimer=a,this._flickerTimer<0&&(this._flicker=!1,this.visible=!0)},reset:function(a,b){a==undefined&&(a=0),b==undefined&&(b=0),this.x=a,this.y=b,this.exists=!0,this.dead=!1},overlaps:function(a){this._point=this.getScreenXY(this._point);var b=this._point.x,c=this._point.y,d=this.width,e=this.height;if(this.isSprite!=undefined){var f=this;d=f.frameWidth,e=f.frameHeight}this._point=a.getScreenXY(this._point);var g=this._point.x,h=this._point.y,i=this.object.width,j=this.object.height;if(a.isSprite!=undefined){var k=a;i=k.frameWidth,j=k.frameHeight}return g<=b-i||g>=b+d||h<=c-j||h>=c+e?!1:!0},overlapsPoint:function(a,b,c){c==undefined&&(c=!1),a+=Math.floor(Jxl.scroll.x),b+=Math.floor(Jxl.scroll.y),this._point=this.getScreenXY(this._point);return a<=this._point.x||a>=this._point.x+this.width||b<=this._point.y||b>=this._point.y+this.height?!1:!0},collide:function(a){a==undefined&&(a=this);return Jxl.Util.collide(this,a)},preCollide:function(a){},hitLeft:function(a,b){this.fixed||(this.velocity.x=b)},hitRight:function(a,b){this.hitLeft(a,b)},hitTop:function(a,b){this.fixed||(this.velocity.y=b)},hitBottom:function(a,b){this.onFloor=!0,this.fixed||(this.velocity.y=b)},flickering:function(){return this._flickerTimer>=0},hurt:function(a){(this.health-=a)<=0&&this.kill()},kill:function(){this.exists=!1,this.dead=!0},render:function(){this.border.visible&&(this._point=this.getScreenXY(this._point),this.renderBorder())},renderBorder:function(a){Jxl.buffer.strokeStyle=this.border.color,Jxl.buffer.lineWidth=this.border.thickness,Jxl.buffer.strokeRect(this._point.x-this.border.thickness,this._point.y-this.border.thickness,this.width+this.border.thickness,this.height+this.border.thickness)},getScreenXY:function(a){a==undefined&&(a=new Jxl.Point),a.x=Math.floor(this.x+Jxl.Util.roundingError)+Math.floor(Jxl.scroll.x*this.scrollFactor.x),a.y=Math.floor(this.y+Jxl.Util.roundingError)+Math.floor(Jxl.scroll.y*this.scrollFactor.y);return a}}),def("Jxl.Group",{extend:Jxl.Object,init:function(a){Jxl.Object.prototype.init.call(this,a),_(this).extend({_group:!0,solid:!1,members:[],_last:new Jxl.Point,_first:!0}),this.applyParams(a)},statics:{ASCENDING:-1,DESCENDING:1},add:function(a,b){b=b===undefined?!1:b,this.members.indexOf(a)<0&&(this.members[this.members.length]=a),b&&(a.scrollFactor=this.scrollFactor);return a},replace:function(a,b){var c=this.members.indexOf(a);if(c<0||c>=this.members.length)return null;this.members[c]=b;return b},remove:function(a,b){b=b===undefined?!1:b;var c=this.members.indexOf(a);if(c<0||c>=this.members.length)return null;b?this.members.splice(c,1):this.members[c]=null;return a},sort:function(a,b){a=a===undefined?"y":a,b=b===undefined?Jxl.Group.ASCENDING:b,this._sortIndex=a,this._sortOrder=b,this.members.sort(this.sortHandler)},getFirstAvail:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=undefined&&!b.exists)return b}return null},getFirstNull:function(){var a=0,b=this.members.length;while(a<b){if(this.members[a]==undefined)return a;a++}return-1},resetFirstAvail:function(a,b){a=a===undefined?0:a,b=b===undefined?0:b;var c=this.getFirstAvail();if(c==null)return!1;c.reset(a,b);return!0},getFirstExtant:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.exists)return b}return null},getFirstAlive:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.exists&&!b.dead)return b}return null},getFirstDead:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.dead)return b}return null},countLiving:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.exists&&!c.dead&&a++);return a},countDead:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.dead&&a++);return a},countOnScreen:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.onScreen()&&a++);return a},getRandom:function(){var a=0,b=null,c=this.members.length,d=Math.floor(Jxl.Util.random()*c);while((b===null||b===undefined)&&a<this.members.length)b=this.members[++d%c],a++;return b},saveOldPosition:function(){this._first?(this._first=!1,this._last.x=0,this._last.y=0):(this._last.x=this.x,this._last.y=this.y)},updateMembers:function(a){var b,c,d=!1;if(this.x!=this._last.x||this.y!=this._last.y)d=!0,b=this.x-this._last.x,c=this.y-this._last.y;var e=0,f,g=this.members.length;while(e<g)f=this.members[e++],f!=null&&f.exists&&(d&&(f._group?f.reset(f.x+b,f.y+c):(f.x+=b,f.y+=c)),f.active&&f.update(a),d&&f.solid&&(f.colHullX.width+=b>0?b:-b,b<0&&(f.colHullX.x+=b),f.colHullY.x=this.x,f.colHullY.height+=c>0?c:-c,c<0&&(f.colHullY.y+=c),f.colVector.x+=b,f.colVector.y+=c))},update:function(){this.saveOldPosition(),this.updateMotion(),this.updateMembers(),this.updateFlickering()},renderMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=this.members[a++],b!=null&&b.exists&&b.visible&&b.render()},render:function(){this.renderMembers()},killMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=this.members[a++],b!=null&&b.kill()},kill:function(){this.killMembers(),Jxl.Object.prototype.kill.call(this)},destroyMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=members[a++],b!=null&&b.destroy();this.members.length=0},destroy:function(){this.destroyMembers(),this.parent()},reset:function(a,b){this.saveOldPosition(),this.parent(a,b);var c,d,e=!1;if(this.x!=this._last.x||this.y!=this._last.y)e=!0,c=this.x-this._last.x,d=this.y-this._last.y;var f=0,g,h=this.members.length;while(f<h)g=members[f++],g!=null&&g.exists&&e&&(g._group?g.reset(g.x+c,g.y+d):(g.x+=c,g.y+=d,this.solid&&(g.colHullX.width+=c>0?c:-c,c<0&&(g.colHullX.x+=c),g.colHullY.x=this.x,g.colHullY.height+=d>0?d:-d,d<0&&(g.colHullY.y+=d),g.colVector.x+=c,g.colVector.y+=d)))},sortHandler:function(a,b){if(a[this._sortIndex]<b[this._sortIndex])return this._sortOrder;if(a[this._sortIndex]>b[this._sortIndex])return-this._sortOrder;return 0}}),def("Jxl.State",{init:function(a){_(this).extend({defaultGroup:new Jxl.Group}),_(this).extend(a)},add:function(a){return this.defaultGroup.add(a)},remove:function(a){this.defaultGroup.remove(a)},preProcess:function(){Jxl.buffer.clearRect(0,0,Jxl.width,Jxl.height)},update:function(){this.defaultGroup.update()},collide:function(){Jxl.Util.collide(this.defaultGroup,this.defaultGroup)},render:function(){this.defaultGroup.render()},postProcess:function(){},destroy:function(){this.defaultGroup.destroy()}}),def("Jxl.Sprite",{extend:Jxl.Object,init:function(a){var b=this;Jxl.Object.prototype.init.call(this,a),_(this).extend({isSprite:!0,width:32,height:32,angle:0,_alpha:1,_color:16777215,_blend:null,_facing:1,_animations:{},reverse:!1,_curFrame:0,_frameTimer:0,finished:!1,rotPoint:new Jxl.Point,_caf:0,scale:new Jxl.Point({x:1,y:1}),offset:new Jxl.Point,_curAnim:null,animated:!1}),this.loadGraphic(a)},play:function(a,b){this.animated=!0,b==undefined&&(b=!1);if(!!b||this._curAnim==null||a!=this._curAnim.name)this._curFrame=0,this._caf=0,this._curAnim=this._animations[a],this._curFrame=this._curAnim.frames[this._caf]},flip:function(){this.bufferCTX.scale(-1,1),this.bufferCTX.translate(-this.width,0)},calcFrame:function(){this.buffer.width=this.width,this.bufferCTX.clearRect(0,0,this.width,this.height);var a=this._curFrame*this.width,b=0;a>this.graphic.width&&(b=Math.floor(a/this.graphic.width)*this.height,a=a%this.graphic.width),this.reverse&&this.flip(),this.bufferCTX.drawImage(this.graphic,a,b,this.width,this.height,0,0,this.width,this.height)},render:function(){if(!!this.visible){(this.animated||this.reverse)&&this.calcFrame();var a=this.buffer;this._point=this.getScreenXY(this._point),(this.border.visible||Jxl.showBB)&&this.renderBorder(this._point),this.angle!=0?(Jxl.buffer.save(),this.rotPoint.x=this._point.x+this.width/2,this.rotPoint.y=this._point.y+this.height/2,Jxl.buffer.translate(this.rotPoint.x,this.rotPoint.y),Jxl.buffer.rotate(this.angle*Math.PI/180),Jxl.buffer.translate(-this.rotPoint.x,-this.rotPoint.y),Jxl.buffer.drawImage(a,this._point.x,this._point.y,this.width*this.scale.x,this.height*this.scale.y),Jxl.buffer.restore()):Jxl.buffer.drawImage(a,this._point.x,this._point.y,this.width*this.scale.x,this.height*this.scale.y)}},onEmit:function(){},updateAnimation:function(){this._curAnim!=null&&this._curAnim.delay>0&&(this._curAnim.looped||!this.finished)&&(this._frameTimer+=Jxl.delta,this._frameTimer>this._curAnim.delay&&(this._frameTimer-=this._curAnim.delay,this._caf==this._curAnim.frames.length-1?(this._curAnim.looped&&(this._caf=0),this.finished=!0,this.animationComplete(this._curAnim.name,this._curAnim.looped)):this._caf++,this._curFrame=this._curAnim.frames[this._caf]))},animationComplete:function(a,b){},addAnimation:function(a,b,c,d){c==undefined&&(c=0),d==undefined&&(d=!0),this._animations[a]=new Jxl.Anim(a,b,c,d)},update:function(){this.updateMotion(),this.updateAnimation(),this.updateFlickering()},getScreenXY:function(a){a==undefined&&(a=new Jxl.Point),a.x=Math.floor(this.x+Jxl.Util.roundingError)+Math.floor(Jxl.scroll.x*this.scrollFactor.x)-this.offset.x,a.y=Math.floor(this.y+Jxl.Util.roundingError)+Math.floor(Jxl.scroll.y*this.scrollFactor.y)-this.offset.y;return a},overlapsPoint:function(a,b,c,d){d==undefined&&(d=!1),b-=Math.floor(Jxl.scroll.x),c-=Math.floor(Jxl.scroll.y),this._point=this.getScreenXY(this._point);return b<=this._point.x||b>=this._point.x+this.width||c<=this._point.y||c>=this._point.y+this.height?!1:!0},getFacing:function(){return this._facing},setFacing:function(a){var b=this._facing!=a;this._facing=a,b&&this.calcFrame()},resetHelpers:function(){this._boundsVisible=!1,this.origin.x=this.width*.5,this.origin.y=this.height*.5,this.graphic&&(this.frames=Math.floor(this.graphic.width/this.width*this.graphic.height/this.height)),this._caf=0,this.refreshHulls(),this._graphicCTX=this.graphic.getContext("2d")},loadGraphic:function(a){this.applyParams(a),this.buffer=document.createElement("canvas"),this.buffer.width=this.width,this.buffer.height=this.height,this.graphic==undefined&&(this.graphic=document.createElement("canvas")),this.bufferCTX=this.buffer.getContext("2d"),this.bufferCTX.drawImage(this.graphic,0,0,this.width,this.height,0,0,this.width,this.height),this.resetHelpers();return this},createGraphic:function(a,b,c){c=c==undefined?4294967295:c,this.graphic=document.createElement("canvas");var d=this.graphic.getContext("2d");this.width=this.graphic.width=this.frameWidth=a,this.height=this.graphic.height=this.frameHeight=b,d.fillStyle=Jxl.Util.makeRGBA(c),d.fillRect(0,0,a,b),this.resetHelpers();return this}}),Jxl.Sprite.LEFT=0,Jxl.Sprite.RIGHT=1,Jxl.Sprite.UP=2,Jxl.Sprite.DOWN=3,def("Jxl.Anim",{init:function(a,b,c,d){this.name=a,this.delay=0,c>0&&(this.delay=c),this.frames=b,this.looped=d}}),def("Jxl.TileMap",{extend:Jxl.Object,init:function(a){Jxl.Object.prototype.init.call(this,a),_(this).extend({auto:Jxl.TileMapOFF,collideIndex:1,noCollide:{},startingIndex:0,drawIndex:1,widthInTiles:0,heightInTiles:0,totalTiles:0,_buffer:null,_bufferLoc:new Jxl.Point,_flashRect2:new Jxl.Rect,_flashRect:new Jxl.Rect,_data:null,_tileWidth:0,_tileHeight:0,_rects:null,_pixels:null,_block:new Jxl.Object({width:0,height:0,fixed:!0}),_callbacks:[],fixed:!0}),this.loadMap(a)},loadMap:function(a){this.applyParams(a);if(this.tileGraphic){var b,c,d=this.mapData.split("\n");this.heightInTiles=d.length,this._data=[];for(var e=0;e<this.heightInTiles;e++){c=d[e].split(",");if(c.length<=1){this.heightInTiles--;continue}this.widthInTiles==0&&(this.widthInTiles=c.length);for(b=0;b<this.widthInTiles;b++)this._data.push(c[b])}var f;this.totalTiles=this.widthInTiles*this.heightInTiles;if(this.auto>Jxl.TileMapOFF){this.collideIndex=this.startingIndex=this.drawIndex=1,f=0;while(f<this.totalTiles)b;this.autoTile(f++)}this._pixels=this.tileGraphic,this.tileWidth==undefined?this._tileWidth=this._pixels.height:this._tileWidth=this.tileWidth,this.tileHeight==undefined?this._tileHeight=this._tileWidth:this._tileHeight=this.tileHeight,this._block.width=this._tileWidth,this._block.height=this._tileHeight,this.width=this.widthInTiles*this._tileWidth,this.height=this.heightInTiles*this._tileHeight,this._rects=Array(this.totalTiles);for(f=0;f<this.totalTiles;f++)this.updateTile(f);this._screenRows=Math.ceil(Jxl.height/this._tileHeight)+1,this._screenRows>this.heightInTiles&&(this._screenRows=this.heightInTiles),this._screenCols=Math.ceil(Jxl.width/this._tileWidth)+1,this._screenCols>this.widthInTiles&&(this._screenCols=this.widthInTiles)}return this},render:function(){this._point=this.getScreenXY(this._point);var a=new Jxl.Point({x:this._point.x,y:this._point.y}),b=Math.floor(-this._point.x/this._tileWidth),c=Math.floor(-this._point.y/this._tileHeight);b<0&&(b=0),b>this.widthInTiles-this._screenCols&&(b=this.widthInTiles-this._screenCols),c<0&&(c=0),c>this.heightInTiles-this._screenRows&&(c=this.heightInTiles-this._screenRows);var d=c*this.widthInTiles+b;a.x+=b*this._tileWidth,a.y+=c*this._tileHeight;var e=a.x,f,g;for(var h=0;h<this._screenRows;h++){g=d;for(f=0;f<this._screenCols;f++){var i=this._rects[g++];i!=null&&Jxl.buffer.drawImage(this._pixels,i[0],i[1],i[2],i[3],a.x,a.y,this._tileWidth,this._tileHeight),a.x+=this._tileWidth}d+=this.widthInTiles,a.x=e,a.y+=this._tileHeight}},updateTile:function(a){if(this._data[a]<this.drawIndex)this._rects[a]=null;else{var b=(this._data[a]-this.startingIndex)*this._tileWidth,c=0;b>=this._pixels.width&&(c=Math.floor(Math.abs(b/this._pixels.width))*this._tileHeight,b=b%this._pixels.width),this._rects[a]=[b,c,this._tileWidth,this._tileHeight]}},autoTile:function(a){if(this._data[a]!=0){this._data[a]=0;if(a-this.widthInTiles<0||this._data[a-this.widthInTiles]>0)this._data[a]+=1;if(a%this.widthInTiles>=this.widthInTiles-1||this._data[a+1]>0)this._data[a]+=2;if(a+this.widthInTiles>=this.totalTiles||this._data[a+this.widthInTiles]>0)this._data[a]+=4;if(a%this.widthInTiles<=0||this._data[a-1]>0)this._data[a]+=8;this.auto==Jxl.TileMapALT&&this._data[a]==15&&(a%this.widthInTiles>0&&a+this.widthInTiles<this.totalTiles&&this._data[a+this.widthInTiles-1]<=0&&(this._data[a]=1),a%this.widthInTiles>0&&a-this.widthInTiles>=0&&this._data[a-this.widthInTiles-1]<=0&&(this._data[a]=2),a%this.widthInTiles<this.widthInTiles-1&&a-this.widthInTiles>=0&&this._data[a-this.widthInTiles+1]<=0&&(this._data[a]=4),a%this.widthInTiles<this.widthInTiles-1&&a+this.widthInTiles<this.totalTiles&&this._data[a+this.widthInTiles+1]<=0&&(this._data[a]=8)),this._data[a]+=1}},overlaps:function(a){var b,c,d=[],e=Math.floor((a.x-this.x)/this._tileWidth),f=Math.floor((a.y-this.y)/this._tileHeight),g=Math.ceil(a.width/this._tileWidth)+1,h=Math.ceil(a.height/this._tileHeight)+1,i=0,j;while(i<h){if(i>=this.heightInTiles)break;b=(f+i)*this.widthInTiles+e,j=0;while(j<g){if(j>=this.widthInTiles)break;c=Math.floor(this._data[b+j]),c>=this.collideIndex&&!(c in this.noCollide)&&d.push({x:this.x+(e+j)*this._tileWidth,y:this.y+(f+i)*this._tileHeight,data:c}),j++}i++}var k=d.length,l=!1,m=0;while(m<k){this._block.x=d[m].x,this._block.y=d[m++].y;if(this._block.overlaps(a))return!0}return!1},renderTileBB:function(a,b){a>=this.widthInTiles||b>=this.heightInTiles||(Jxl.buffer.strokeStyle=this.border.color,Jxl.buffer.lineWidth=this.border.thickness,Jxl.buffer.strokeRect(this._point.x-this.border.thickness+a*this.tileWidth,this._point.y-this.border.thickness+b*this.tileHeight,this.tileWidth+this.border.thickness,this.tileHeight+this.border.thickness))},setTile:function(a,b,c,d){d=d===undefined?!0:d;return a>=this.widthInTiles||b>=this.heightInTiles?!1:this.setTileByIndex(b*this.widthInTiles+a,c,d)},setTileByIndex:function(a,b,c){c=c===undefined?!0:c;if(a>=this._data.length)return!1;var d=!0;this._data[a]=b;if(!c)return d;this.refresh=!0;if(this.auto==Jxl.TilemapOFF){this.updateTile(a);return d}var e,f=Math.floor(a/this.widthInTiles)-1,g=f+3,h=a%this.widthInTiles-1,i=h+3;while(f<g){h=i-3;while(h<i)f>=0&&f<this.heightInTiles&&h>=0&&h<this.widthInTiles&&(e=f*this.widthInTiles+h,this.autoTile(e),this.updateTile(e)),h++;f++}return d},overlapsPoint:function(a,b,c){var d=getTile(Math.floor((a-this.x)/this._tileWidth),Math.floor((b-this.y)/this._tileHeight));return d>=this.collideIndex&&!(d in this.noCollide)},refreshHulls:function(){this.colHullX.x=0,this.colHullX.y=0,this.colHullX.width=this._tileWidth,this.colHullX.height=this._tileHeight,this.colHullY.x=0,this.colHullY.y=0,this.colHullY.width=this._tileWidth,this.colHullY.height=this._tileHeight},preCollide:function(a){var b,c,d,e,f=0,g=Math.floor((a.x-this.x)/this._tileWidth),h=Math.floor((a.y-this.y)/this._tileHeight),i=g+Math.ceil(a.width/this._tileWidth+1),j=h+Math.ceil(a.height/this._tileHeight+1);g<0&&(g=0),h<0&&(h=0),i>this.widthInTiles&&(i=this.widthInTiles),j>this.heightInTiles&&(j=this.heightInTiles),e=h*this.widthInTiles,b=h;for(b=h;b<j;b++){for(c=g;c<i;c++)d=Math.floor(Math.abs(this._data[e+c])),d>=this.collideIndex&&!(d in this.noCollide)&&(this.colOffsets[f++]=new Jxl.Point({x:this.x+c*this._tileWidth,y:this.y+b*this._tileHeight}));e+=this.widthInTiles}this.colOffsets.length!=f&&(this.colOffsets.length=f)},ray:function(a,b,c,d,e,f){f=f===undefined?1:f;var g=this._tileWidth;this._tileHeight<this._tileWidth&&(g=this._tileHeight),g/=f;var h=c-a,i=d-b,j=Math.sqrt(h*h+i*i),k=Math.ceil(j/g),l=h/k,m=i/k,n=a-l,o=b-m,p,q,r,s=0;while(s<k){n+=l,o+=m;if(n<0||n>width||o<0||o>height){s++;continue}p=n/this._tileWidth,q=o/this._tileHeight,r=Math.floor(this._data[q*this.widthInTiles+p]);if(r>=this.collideIndex&&!(r in this.noCollide)){p*=this._tileWidth,q*=this._tileHeight;var t=0,u=0,v,w=n-l,x=o-m;v=p,h<0&&(v+=this._tileWidth),t=v,u=x+m*((v-w)/l);if(u>q&&u<q+this._tileHeight){e===undefined&&(e=new Jxl.Point),e.x=t,e.y=u;return!0}v=q,i<0&&(v+=this._tileHeight),t=w+l*((v-x)/m),u=v;if(t>p&&t<p+this._tileWidth){e===undefined&&(e=new Jxl.Point),e.x=t,e.y=u;return!0}return!1}s++}return!1}}),Jxl.TileMapOFF=0,Jxl.TileMapAUTO=1,Jxl.TileMapALT=2,Jxl.TileMap.arrayToCSV=function(a,b){var c=0,d,e="",f=a.length/b;while(c<f){d=0;while(d<b)d==0?c==0?e+=a[0]:e+="\n"+a[c*b]:e+=", "+a[c*b+d],d++;c++}return e},def("Jxl.Audio",{init:function(){this.sounds={},this.channels=[];for(var a=0;a<16;a++)this.channels[a]=document.createElement("audio"),this.channels[a].dead=!0},play:function(a,b,c,d,e){if(a in this.sounds)for(var f=0;f<this.channels.length;f++)if(this.channels[f].dead){this.channels[f].dead=!1,this.channels[f].src=this.sounds[a].src,this.channels[f].start=0,this.channels[f].finish=this.sounds[a].duration,c?this.channels[f].volume=c:this.channels[f].volume=1,b?this.channels[f].loop=!0:this.channels[f].loop=!1,d&&(this.channels[f].currentTime=d,this.channels[f].start=d),e&&(this.channels[f].finish=e),this.channels[f].play();return}},unpause:function(){for(var a=0;a<this.channels.length;a++)this.channels[a].dead||this.channels[a].play()},pause:function(){for(var a=0;a<this.channels.length;a++)this.channels[a].dead||this.channels[a].pause()},update:function(){var a=this.channels.length-1;while(a>=0)!this.channels[a].paused&&this.channels[a].currentTime>=this.channels[a].finish&&(this.channels[a].loop?this.channels[a].currentTime=this.channels[a].start:(this.channels[a].dead=!0,this.channels[a].pause())),a--},add:function(a,b){this.sounds[a]=b}}),def("Jxl.AssetManager",{init:function(){this.assets={},this.batches=[]},alias:"Jxl.am",singleton:!0,get:function(a){return this.assets[a]},reload:function(a){var b=this,c=this.batches.length,d=0;_(this.batches).each(function(e){b.load(e,function(){d++,a!=undefined&&c==d&&a()})})},load:function(a,b,c){var d=this,e=0,f=0;a.images&&_(a.images).each(function(a,g){d.loadAsset("image",g,a,function(a){e++,b!=undefined&&e>=f&&b(),c&&c(e,f)}),f++}),a.sounds&&_(a.sounds).each(function(a,g){d.loadAsset("sound",g,a,function(a){e++,b!=undefined&&e>=f&&b(),c&&c(e,f)}),f++}),a.data&&_(a.data).each(function(a,g){d.loadAsset("data",g,a,function(a){e++,b!=undefined&&e>=f&&b(),c&&c(e,f)}),f++})},loadAsset:function(a,b,c,d){var e=this;if(b in this.assets)d&&d();else switch(a){case"audio":case"sound":var f=new Audio(c);f.src=c,f.load(),this.assets[b]=f,Jxl.audio.add(b,f),d&&d(f);break;case"image":var f=document.createElement("img");f.src=c,f.addEventListener("load",function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var c=a.getContext("2d");c.drawImage(this,0,0),e.assets[b]=a,d&&d(a)},!0);break;case"data":var g=new XMLHttpRequest;g.onreadystatechange=function(){g.readyState==4&&g.status==200&&(e.assets[b]=g.responseText,d&&d(g.responseText))},g.open("GET",c,!0),g.send()}}}),def("Jxl.List",{init:function(){this.object=null,this.next=null}}),def("Jxl.QuadTree",{extend:Jxl.Rect,init:function(a,b,c,d,e){Jxl.Rect.prototype.init.call(this,a,b,c,d),this._headA=this._tailA=new Jxl.List,this._headB=this._tailB=new Jxl.List;if(e!=undefined){var f,g;if(e._headA.object!=null){f=e._headA;while(f!=null)this._tailA.object!=null&&(g=this._tailA,this._tailA=new Jxl.List,g.next=this._tailA),this.tailA.object=f.object,f=f.next}if(e._headB.object!=null){f=e._headB;while(f!=null)this._tailB.object!=null&&(g=this._tailB,this._tailB=new Jxl.List,g.next=this._tailB),this._tailB.object=f.object,f=f.next}}else this._min=(this.width+this.height)/(2*Jxl.Util.quadTreeDivisions);this._canSubdivide=this.width>this._min||this.height>Jxl.QuadTree._min,this._nw=null,this._ne=null,this._se=null,this._sw=null,this._l=this.x,this._r=this.x+this.width,this._hw=this.width/2,this._mx=this._l+this._hw,this._t=this.y,this._b=this.y+this.height,this._hh=this.height/2,this._my=this._t+this._hh},add:function(a,b){Jxl.QuadTree._oa=b;if(a._group){var c,d=a.members,e=d.length;for(var f=0;f<e;f++)c=d[f],c!==null&&c.exists&&(c._group?this.add(c,b):c.solid&&(Jxl.QuadTree._o=c,Jxl.QuadTree._ol=Jxl.QuadTree._o.x,Jxl.QuadTree._ot=Jxl.QuadTree._o.y,Jxl.QuadTree._or=Jxl.QuadTree._o.x+Jxl.QuadTree._o.width,Jxl.QuadTree._ob=Jxl.QuadTree._o.y+Jxl.QuadTree._o.height,this.addObject()))}a.solid&&(Jxl.QuadTree._o=a,Jxl.QuadTree._ol=Jxl.QuadTree._o.x,Jxl.QuadTree._ot=Jxl.QuadTree._o.y,Jxl.QuadTree._or=Jxl.QuadTree._o.x+Jxl.QuadTree._o.width,Jxl.QuadTree._ob=Jxl.QuadTree._o.y+Jxl.QuadTree._o.height,this.addObject())},addObject:function(){if(!this._canSubdivide||this._l>=Jxl.QuadTree._ol&&this._r<=Jxl.QuadTree._or&&this._t>=Jxl.QuadTree._ot&&this._b<=Jxl.QuadTree._ob)this.addToList();else{if(Jxl.QuadTree._ol>this._l&&Jxl.QuadTree._or<this._mx){if(Jxl.QuadTree._ot>this._t&&Jxl.QuadTree._ob<this._my){this._nw===null&&(this._nw=new Jxl.QuadTree(this._l,this._t,this._hw,this._hh,this)),this._nw.addObject();return}if(Jxl.QuadTree._ot>this._my&&Jxl.QuadTree._ob<this._b){this._sw===null&&(this._sw=new Jxl.QuadTree(this._l,this._my,this._hw,this._hh,this)),this._sw.addObject();return}}if(Jxl.QuadTree._ol>this._mx&&Jxl.QuadTree._or<this._r){if(Jxl.QuadTree._ot>this._t&&Jxl.QuadTree._ob<this._my){this._ne===null&&(this._ne=new Jxl.QuadTree(this._mx,this._t,this._hw,this._hh,this)),this._ne.addObject();return}if(Jxl.QuadTree._ot>this._my&&Jxl.QuadTree._ob<this._b){this._se===null&&(this._se=new Jxl.QuadTree(this._mx,this._my,this._hw,this._hh,this)),this._se.addObject();return}}Jxl.QuadTree._or>this._l&&Jxl.QuadTree._ol<this._mx&&Jxl.QuadTree._ob>this._t&&Jxl.QuadTree._ot<this._my&&(this._nw===null&&(this._nw=new Jxl.QuadTree(this._l,this._t,this._hw,this._hh,this)),this._nw.addObject()),Jxl.QuadTree._or>this._mx&&Jxl.QuadTree._ol<this._r&&Jxl.QuadTree._ob>this._t&&Jxl.QuadTree._ot<this._my&&(this._ne===null&&(this._ne=new Jxl.QuadTree(this._mx,this._t,this._hw,this._hh,this)),this._ne.addObject()),Jxl.QuadTree._or>this._mx&&Jxl.QuadTree._ol<this._r&&Jxl.QuadTree._ob>this._my&&Jxl.QuadTree._ot<this._b&&(this._se===null&&(this._se=new Jxl.QuadTree(this._mx,this._my,this._hw,this._hh,this)),this._se.addObject()),Jxl.QuadTree._or>this._l&&Jxl.QuadTree._ol<this._mx&&Jxl.QuadTree._ob>this._my&&Jxl.QuadTree._ot<this._b&&(this._sw===null&&(this._sw=new Jxl.QuadTree(this._l,this._my,this._hw,this._hh,this)),this._sw.addObject())}},addToList:function(){var a;Jxl.QuadTree._oa==Jxl.QuadTree.A_LIST?(this._tailA.object!==null&&(a=this._tailA,this._tailA=new Jxl.List,a.next=this._tailA),this._tailA.object=Jxl.QuadTree._o):(this._tailB.object!==null&&(a=this._tailB,this._tailB=new Jxl.List,a.next=this._tailB),this._tailB.object=Jxl.QuadTree._o);!this._canSubdivide||(this._nw!==null&&this._nw.addToList(),this._ne!==null&&this._ne.addToList(),this._se!==null&&this._se.addToList(),this._sw!==null&&this._sw.addToList())},overlap:function(a,b){a=a===undefined?!0:a,b=b===undefined?null:b,Jxl.QuadTree._oc=b;var c=!1,d;if(a){Jxl.QuadTree._oa=Jxl.QuadTree.B_LIST;if(this._headA.object!==null){d=this._headA;while(d!==null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&this.overlapNode()&&(c=!0),d=d.next}Jxl.QuadTree._oa=Jxl.QuadTree.A_LIST;if(this._headB.object!==null){d=this._headB;while(d!==null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&(this._nw!==null&&this._nw.overlapNode()&&(c=!0),this._ne!==null&&this._ne.overlapNode()&&(c=!0),this._se!==null&&this._se.overlapNode()&&(c=!0),this._sw!==null&&this._sw.overlapNode()&&(c=!0)),d=d.next}}else if(this._headA.object!==null){d=this._headA;while(d!=null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&this.overlapNode(d.next)&&(c=!0),d=d.next}this._nw!=null&&this._nw.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._ne!=null&&this._ne.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._se!=null&&this._se.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._sw!=null&&this._sw.overlap(a,Jxl.QuadTree._oc)&&(c=!0);return c},overlapNode:function(a){a=a===undefined?null:a;var b=!1,c,d=a;d==null&&(this._oa==Jxl.QuadTree.A_LIST?d=this._headA:d=this._headB);if(d.object!=null)while(d!=null){c=d.object;if(Jxl.QuadTree._o===c||!c.exists||!Jxl.QuadTree._o.exists||!c.solid||!Jxl.QuadTree._o.solid||Jxl.QuadTree._o.x+Jxl.QuadTree._o.width<c.x+Jxl.Util.roundingError||Jxl.QuadTree._o.x+Jxl.Util.roundingError>c.x+c.width||Jxl.QuadTree._o.y+Jxl.QuadTree._o.height<c.y+Jxl.Util.roundingError||Jxl.QuadTree._o.y+Jxl.Util.roundingError>c.y+c.height){d=d.next;continue}Jxl.QuadTree._oc==null?(Jxl.QuadTree._o.kill(),c.kill(),b=!0):Jxl.QuadTree._oc(Jxl.QuadTree._o,c)&&(b=!0),d=d.next}return b}}),Jxl.QuadTree.A_LIST=0,Jxl.QuadTree.B_LIST=1,Jxl.QuadTree.divisions=3,Jxl.QuadTree.quadTree=null,Jxl.QuadTree.bounds=null,def("Jxl.Util",{roundingError:1e-7,quadTreeDivisions:3,singleton:!0,random:function(a){if(a==undefined||a===undefined)return Math.random();a==0&&(a=Number.MIN_VALUE),a>=1?(a%1==0&&(a/=Math.PI),a%=1):a<0&&(a=a%1+1);return 69621*Math.floor(a*2147483647)%2147483647/2147483647},overlap:function(a,b,c){if(a==null||!a.exists||b==null||!b.exists)return!1;quadTree=new Jxl.QuadTree(Jxl.QuadTree.bounds.x,Jxl.QuadTree.bounds.y,Jxl.QuadTree.bounds.width,Jxl.QuadTree.bounds.height),quadTree.add(a,Jxl.QuadTree.A_LIST);if(a===b)return quadTree.overlap(!1,c);quadTree.add(b,Jxl.QuadTree.B_LIST);return quadTree.overlap(!0,c)},makeRGBA:function(a){var b=a.toString(16),c=parseInt(b.substr(0,2),16)/255,d=parseInt(b.substr(2,2),16),e=parseInt(b.substr(4,2),16),f=parseInt(b.substr(6,2),16);return"rgba("+d+","+e+","+f+","+c+")"},collide:function(a,b){if(a==null||!a.exists||b==null||!b.exists)return!1;quadTree=new Jxl.QuadTree(Jxl.QuadTree.bounds.x,Jxl.QuadTree.bounds.y,Jxl.QuadTree.bounds.width,Jxl.QuadTree.bounds.height),quadTree.add(a,Jxl.QuadTree.A_LIST);var c=a===b;c||quadTree.add(b,Jxl.QuadTree.B_LIST);var d=quadTree.overlap(!c,Jxl.Util.solveXCollision),e=quadTree.overlap(!c,Jxl.Util.solveYCollision);return d||e},rotatePoint:function(a,b,c,d,e,f){f==undefined&&(f=new JxlPoint);var g=-e/180*Math.PI,h=a-c,i=d-b;f.x=c+Math.cos(g)*h-Math.sin(g)*i,f.y=d-(Math.sin(g)*h+Math.cos(g)*i);return f},solveXCollision:function(a,b){var c=a.colVector.x,d=b.colVector.x;if(c==d)return!1;a.preCollide(b),b.preCollide(a);var e,f,g,h=!1,i,j=c==0,k=c<0,l=c>0,m=d==0,n=d<0,o=d>0,p,q,r=a.colHullX,s=b.colHullX,t=a.colOffsets,u=b.colOffsets,v=t.length,w=u.length,x,y,z,A,B,C,D,E;i=j&&n||l&&m||l&&n||k&&n&&(c>0?c:-c)<(d>0?d:-d)||l&&o&&(c>0?c:-c)>(d>0?d:-d);if(i?!a.collideRight||!b.collideLeft:!a.collideLeft||!b.collideRight)return!1;for(p=0;p<v;p++){x=t[p].x,y=t[p].y,r.x+=x,r.y+=y;for(q=0;q<w;q++){z=u[q].x,A=u[q].y,s.x+=z,s.y+=A;if(r.x+r.width<s.x+Jxl.Util.roundingError||r.x+Jxl.Util.roundingError>s.x+s.width||r.y+r.height<s.y+Jxl.Util.roundingError||r.y+Jxl.Util.roundingError>s.y+s.height){s.x-=z,s.y-=A;continue}i?(k?B=r.x+a.colHullY.width:B=r.x+r.width,n?C=s.x:C=s.x+s.width-b.colHullY.width):(n?B=-s.x-b.colHullY.width:B=-s.x-s.width,k?C=-r.x:C=-r.x-r.width+a.colHullY.width),g=B-C;if(g==0||!a.fixed&&(g>0?g:-g)>r.width*.8||!b.fixed&&(g>0?g:-g)>s.width*.8){s.x-=z,s.y-=A;continue}h=!0,D=b.velocity.x,E=a.velocity.x,!a.fixed&&b.fixed?a._group?a.reset(a.x-g,a.y):a.x-=g:a.fixed&&!b.fixed?b._group?b.reset(b.x+g,b.y):b.x+=g:!a.fixed&&!b.fixed&&(g/=2,a._group?a.reset(a.x-g,a.y):a.x-=g,b._group?b.reset(b.x+g,b.y):b.x+=g,D/=2,E/=2),i?(a.hitRight(b,D),b.hitLeft(a,E)):(a.hitLeft(b,D),b.hitRight(a,E)),!a.fixed&&g!=0&&(i?r.width-=g:(r.x-=g,r.width+=g),a.colHullY.x-=g),!b.fixed&&g!=0&&(i?(s.x+=g,s.width-=g):s.width+=g,b.colHullY.x+=g),s.x-=z,s.y-=A}r.x-=x,r.y-=y}return h},solveYCollision:function(a,b){var c=a.colVector.y,d=b.colVector.y;if(c==d)return!1;a.preCollide(b),b.preCollide(a);var e,f=!1,g,h=c==0,i=c<0,j=c>0,k=d==0,l=d<0,m=d>0,n,o,p=a.colHullY,q=b.colHullY,r=a.colOffsets,s=b.colOffsets,t=r.length,u=s.length,v,w,x,y,z,A,B,C;g=h&&l||j&&k||j&&l||i&&l&&(c>0?c:-c)<(d>0?d:-d)||j&&m&&(c>0?c:-c)>(d>0?d:-d);if(g?!a.collideBottom||!b.collideTop:!a.collideTop||!b.collideBottom)return!1;for(n=0;n<t;n++){v=r[n].x,w=r[n].y,p.x+=v,p.y+=w;for(o=0;o<u;o++){x=s[o].x,y=s[o].y,q.x+=x,q.y+=y;if(p.x+p.width<q.x+Jxl.Util.roundingError||p.x+Jxl.Util.roundingError>q.x+q.width||p.y+p.height<q.y+Jxl.Util.roundingError||p.y+Jxl.Util.roundingError>q.y+q.height){q.x-=x,q.y-=y;continue}g?(i?z=p.y+a.colHullX.height:z=p.y+p.height,l?A=q.y:A=q.y+q.height-b.colHullX.height):(l?z=-q.y-b.colHullX.height:z=-q.y-q.height,i?A=-p.y:A=-p.y-p.height+a.colHullX.height),e=z-A;if(e==0||!a.fixed&&(e>0?e:-e)>p.height*.8||!b.fixed&&(e>0?e:-e)>q.height*.8){q.x-=x,q.y-=y;continue}f=!0,B=b.velocity.y,C=a.velocity.y,!a.fixed&&b.fixed?a._group?a.reset(a.x,a.y-e):a.y-=e:a.fixed&&!b.fixed?b._group?b.reset(b.x,b.y+e):b.y+=e:!a.fixed&&!b.fixed&&(e/=2,a._group?a.reset(a.x,a.y-e):a.y-=e,b._group?b.reset(b.x,b.y+e):b.y+=e,B/=2,C/=2),g?(a.hitBottom(b,B),b.hitTop(a,C)):(a.hitTop(b,B),b.hitBottom(a,C)),!a.fixed&&e!=0&&(g?(p.y-=e,b.fixed&&b.moves&&(B=b.colVector.x,a.x+=B,p.x+=B,a.colHullX.x+=B)):(p.y-=e,p.height+=e)),!b.fixed&&e!=0&&(g?(q.y+=e,q.height-=e):(q.height+=e,a.fixed&&a.moves&&(C=a.colVector.x,b.x+=C,q.x+=C,b.colHullX.x+=C))),q.x-=x,q.y-=y}p.x-=v,p.y-=w}return f},getAngle:function(a,b){return Math.atan2(b,a)*180/Math.PI},computeVelocity:function(a,b,c,d){b==undefined&&(b=0),c==undefined&&(c=0),d==undefined&&(d=1e4);if(b!=0)a+=b*Jxl.delta;else if(c!=0){var e=c*Jxl.delta;a-e>0?a-=e:a+e<0?a+=e:a=0}a!=0&&d!=1e4&&(a>d?a=d:a<-d&&(a=-d));return a},range:function(a,b){return Math.random()*(Math.abs(a)+b)-Math.abs(a)},setWorldBounds:function(a,b,c,d,e){a=a==undefined?0:a,b=b==undefined?0:b,c=c==undefined?0:c,d=d==undefined?0:d,e=e==undefined?3:e,Jxl.QuadTree.bounds==null&&(Jxl.QuadTree.bounds=new Jxl.Rect),Jxl.QuadTree.bounds.x=a,Jxl.QuadTree.bounds.y=b,c>0&&(Jxl.QuadTree.bounds.width=c),d>0&&(Jxl.QuadTree.bounds.height=d),e>0&&(Jxl.QuadTree.divisions=e)}}),def("Jxl.Particle",{extend:Jxl.Sprite,init:function(a){Jxl.Sprite.prototype.init.call(this,params),this._bounce=params.bounce},hitSide:function(a,b){this.velocity.x=-this.velocity.x*this._bounce,this.angularVelocity!=0&&(this.angularVelocity=-this.angularVelocity*this._bounce)},hitBottom:function(a,b){this.onFloor=!0,(this.velocity.y>0?this.velocity.y:-this.velocity.y)>this._bounce*100?(this.velocity.y=-this.velocity.y*this._bounce,this.angularVelocity!=0&&(this.angularVelocity*=-this._bounce)):(this.angularVelocity=0,Jxl.Sprite.prototype.hitBottom.call(this,a,b)),this.velocity.x*=this._bounce}}),def("Jxl.Emitter",{extend:Jxl.Group,init:function(a){Jxl.Group.prototype.init.call(this,a),_(this).extend({width:0,height:0,minParticleSpeed:new Jxl.Point({x:-100,y:-100}),maxParticleSpeed:new Jxl.Point({x:100,y:100}),minRotation:-360,maxRotation:360,gravity:400,particleDrag:new Jxl.Point,delay:0,quantity:0,_counter:0,_explode:!0,_particle:0,exists:!1,on:!1,justEmitted:!1}),this.applyParams(a)},createSprites:function(a,b,c,d,e,f){b=b==undefined?50:b,c=c===undefined?new JxlPoint(a.width,a.height):c,d=d===undefined?!0:d,e=e==undefined?0:e,f=f==undefined?0:f,this.members=[];var g,h,i=1,j,k;d&&(h=(new Jxl.Sprite).loadGraphic({graphic:a,animated:!0,width:c.x,height:c.y}),i=h.frames);var l=0;while(l<b)e&&f>0?h=new Jxl.Particle({bounce:f}):h=new Jxl.Sprite,d?(g=Math.random()*i,h.loadGraphic({graphic:a,animated:!0,width:c.x,height:c.y}),h.frame=g):h.loadGraphic({graphic:a}),e>0?(j=h.width,k=h.height,h.width*=e,h.height*=e,h.offset.x=(j-h.width)/2,h.offset.y=(k-h.height)/2,h.solid=!0):h.solid=!1,h.exists=!1,this.add(h),l++;return this},setSize:function(a,b){this.width=a,this.height=b},setXSpeed:function(a,b){a=a==undefined?0:a,b=b==undefined?0:b,this.minParticleSpeed.x=a,this.maxParticleSpeed.x=b},setYSpeed:function(a,b){a=a==undefined?0:a,b=b==undefined?0:b,this.minParticleSpeed.y=a,this.maxParticleSpeed.y=b},setRotation:function(a,b){a=a==undefined?0:a,b=b==undefined?0:b,this.minRotation=a,this.maxRotation=b},updateEmitter:function(){if(this._explode){this._timer+=Jxl.delta;if(this.delay>0&&this._timer>this.delay){this.kill();return}if(this.on){this.on=!1;var a=this._particle,b=this.members.length;this.quantity>0&&(b=this.quantity),b+=this._particle;while(a<b)this.emitParticle(),a++}}else{if(!this.on)return;this._timer+=Jxl.delta;while(this._timer>this.delay&&(this.quantity<=0||this._counter<this.quantity))this._timer-=this.delay,this.emitParticle()}},updateMembers:function(){var a,b=0,c=this.members.length;while(b<c)a=this.members[b++],a!==undefined&&a!==null&&a.exists&&a.active&&a.update()},update:function(){this.justEmitted=!1,Jxl.Group.prototype.update.call(this),this.updateEmitter()},start:function(a,b,c){a=a===undefined?!0:a,b=isNaN(b)?0:b,c=c==undefined?0:c;if(this.members.length<=0)return this;this._explode=a,this._explode||(this._counter=0),this.exists||(this._particle=0),this.exists=!0,this.visible=!0,this.active=!0,this.dead=!1,this.on=!0,this._timer=0,this.quantity==0?this.quantity=c:c!=0&&(this.quantity=c),b!=0&&(this.delay=b),this.delay<0&&(this.delay=-this.delay),this.delay==0&&(a?this.delay=3:this.delay=.1);return this},emitParticle:function(){this._counter++;var a=this.members[this._particle];a.visible=!0,a.exists=!0,a.active=!0,a.x=this.x-(a.width>>1)+Math.random()*this.width,a.y=this.y-(a.height>>1)+Math.random()*this.height,a.velocity.x=this.minParticleSpeed.x,this.minParticleSpeed.x!=this.maxParticleSpeed.x&&(a.velocity.x+=Math.random()*(this.maxParticleSpeed.x-this.minParticleSpeed.x)),a.velocity.y=this.minParticleSpeed.y,this.minParticleSpeed.y!=this.maxParticleSpeed.y&&(a.velocity.y+=Math.random()*(this.maxParticleSpeed.y-this.minParticleSpeed.y)),a.acceleration.y=this.gravity,a.angularVelocity=this.minRotation,this.minRotation!=this.maxRotation&&(a.angularVelocity+=Math.random()*(this.maxRotation-this.minRotation)),a.angularVelocity!=0&&(a.angle=Math.random()*360-180),a.drag.x=this.particleDrag.x,a.drag.y=this.particleDrag.y,this._particle++,this._particle>=this.members.length&&(this._particle=0),a.onEmit(),this.justEmitted=!0},stop:function(a){a=a==undefined?3:a,this._explode=!0,this.delay=a,this.delay<0&&(this.delay=-a),this.on=!1},at:function(a){a.resetHelpers(),this.x=a.x+a.origin.x,this.y=a.y+a.origin.y},kill:function(){Jxl.Group.prototype.kill.call(this),this.on=!1},render:function(){Jxl.Group.prototype.render.call(this)}}),def("Jxl.Mouse",{extend:Jxl.Object,init:function(){Jxl.Object.prototype.init.call(this);var a=this;Jxl.canvas.addEventListener("mousemove",function(b){a.x=b.x/Jxl.scale.x,a.y=b.y/Jxl.scale.x},!0),Jxl.canvas.addEventListener("click",function(a){},!0),Jxl.canvas.addEventListener("contextmenu",function(b){console.log([a.x,a.y]),b.preventDefault?b.preventDefault():b.returnValue=!1;return!1},!0),_(this).extend({scrollFactor:new Jxl.Point({x:0,y:0})})},width:1,height:1}),def("Jxl.Keyboard",{init:function(){var a=this;window.addEventListener("keydown",function(b){a.keys[String.fromCharCode(b.keyCode)]=!0,a.keys[b.keyCode]=!0,b.keyCode in a.pressed||(a.pressed[String.fromCharCode(b.keyCode)]=!0,a.pressed[b.keyCode]=!0)},!0),window.addEventListener("keyup",function(b){delete a.keys[b.keyCode],delete a.keys[String.fromCharCode(b.keyCode)],delete a.pressed[String.fromCharCode(b.keyCode)],delete a.pressed[b.keyCode]},!0),document.body.addEventListener("touchstart",function(b){a.touch=!0,a.touchPress=!0,b.preventDefault()},!0),document.body.addEventListener("touchstop",function(b){a.touch=!1,b.preventDefault()},!0)},touch:!1,touchPress:!1,pressed:{},keys:{},on:function(a){return this.keys[a]},press:function(a){return this.pressed[a]},update:function(){var a=this;_(this.pressed).each(function(b,c){a.pressed[c]=!1}),a.touchPress=!1}})