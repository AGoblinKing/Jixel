var Jixel=new Class({init:function(a,b,c){var d=this;b=b===undefined?240:b,c=c===undefined?160:c,window.addEvent("domready",function(){d.state=new Jxl.State,d.canvas=new Element("canvas"),d.buffer=d.canvas.getContext("2d"),d.scale=1,d.mouse=new Jxl.Mouse,d.showBB=!1,d.autoPause=!0,d._width(b),d._height(c),d.refresh=16,d.running=!1,d.fullScreen=!1,d.keepResolution=!1,d.date=new Date,d.keys={},d._showFPS=!1,d._scrollTarget=new Jxl.Point,d.unfollow(),d.renderedFrames=0,Jxl.u.setWorldBounds(0,0,this.width,this.height),d.overrideElements={INPUT:"",TEXTAREA:""},window.addEvents({blur:function(){d.autoPause&&d.pause()},resize:function(){d.fullScreen&&(d.keepResolution||(d.bufferCanvas.width=d.width=window.get("width"),d.bufferCanvas.height=d.height=window.get("height")),d.canvas.width=window.get("width"),d.canvas.height=window.get("height"))}}),d.canvas.addEvent("click",function(a){d.click(a)}),document.addEvents({keyup:function(a){delete d.keys[a.key.toUpperCase()]},keydown:function(a){d.keys[a.key.toUpperCase()]=!0;if(d.overrideElements[document.activeElement.tagName]==undefined)return!1}}),a()})},toggleFPS:function(){this._showFPS?this.hideFPS():this.showFPS()},follow:function(a,b){b==undefined&&(b=1),this.followTarget=a,this.followLerp=b,this._scrollTarget.x=(this.width>>1)-this.followTarget.x-(this.followTarget.width>>1),this._scrollTarget.y=(this.height>>1)-this.followTarget.y-(this.followTarget.height>>1),this.scroll.x=this._scrollTarget.x,this.scroll.y=this._scrollTarget.y,this.doFollow(0)},doFollow:function(a){this.followTarget!=null&&(this._scrollTarget.x=(this.width>>1)-this.followTarget.x-(this.followTarget.width>>1),this._scrollTarget.y=(this.height>>1)-this.followTarget.y-(this.followTarget.height>>1),this.followLead!=null&&(this._scrollTarget.x-=this.followTarget.velocity.x*this.followLead.x,this._scrollTarget.y-=this.followTarget.velocity.y*this.followLead.y),this.scroll.x+=(this._scrollTarget.x-this.scroll.x)*this.followLerp*a,this.scroll.y+=(this._scrollTarget.y-this.scroll.y)*this.followLerp*a,this.followMin!=null&&(this.scroll.x>this.followMin.x&&(this.scroll.x=this.followMin.x),this.scroll.y>this.followMin.y&&(this.scroll.y=this.followMin.y)),this.followMax!=null&&(this.scroll.x<this.followMax.x&&(this.scroll.x=this.followMax.x),this.scroll.y<this.followMax.y&&(this.scroll.y=this.followMax.y)))},unfollow:function(){this.followTarget=null,this.followLead=null,this.followLerp=1,this.followMin=null,this.followMax=null,this.scroll==null?this.scroll=new Jxl.Point:this.scroll.x=scroll.y=0,this._scrollTarget==null?this._scrollTarget=new Jxl.Point:this._scrollTarget.x=this._scrollTarget.y=0},showFPS:function(){this._showFPS||(this._showFPS=!0,this.UI.fps.render(document.body))},hideFPS:function(){this._showFPS&&(this._showFPS=!1,this.UI.fps.destroy())},_width:function(a){a!=undefined&&(this.screenWidth(a*this.scale),this.width=a)},_height:function(a){a!=undefined&&(this.screenHeight(a*this.scale),this.height=a)},unpause:function(){this.running||(this.running=!0,this.audio.unpause(),this.keys={},this.lastUpdate=new Date,this.UI.pause.destroy())},pause:function(){this.running&&(this.running=!1,this.audio.pause(),this.UI.pause.render(document.body))},screenWidth:function(a){a!=undefined&&(this.canvas.width=a);return this.canvas.width},screenHeight:function(a){a!=undefined&&(this.canvas.height=a);return this.canvas.height},start:function(){document.body.grab(this.canvas);var a=this;a.date=new Date,this.lastUpdate=this.date.getTime(),this.running||(this.running=!0,this.interval=setInterval(function(){if(a.running){a.date=new Date;var b=a.date.getTime(),c=(b-a.lastUpdate)/1e3;a.update(c<1?c:0),a.lastUpdate=b}},this.refresh))},changeScale:function(a){this.scale=a,this._width(this.width),this._height(this.height),this.am.reload()},updateFPS:function(a){this.showFPS&&(this.UI.fps.rendered||this.UI.fps.render(document.body),this.renderedFrames++,this.timeSpent+=a,this.timeSpent>=1&&(this.avgFPS=this.renderedFrames,this.timeSpent=0,this.renderedFrames=0),this.UI.fps.html.set("text","(Cur): "+Math.floor(1/a)))},update:function(a){this.doFollow(a),this.updateFPS(a),this.state.update(a),this.state.preProcess(),this.state.render(),this.mouse.render(),this.state.postProcess()},click:function(){}}),Jxl=new Jixel;Jxl.Point=new Class({Implements:[Options],initialize:function(a){this.setOptions(a),Object.merge(this,this.options)},options:{x:0,y:0}}),Jxl.Rect=new Class({Extends:Jxl.Point,initialize:function(a){this.parent(a)},options:{width:0,height:0},left:function(){return this.x},right:function(){return this.x+this.width},top:function(){return this.y},bottom:function(){return this.y+this.height}}),Jxl.Object=new Class({Extends:Jxl.Rect,initialize:function(a){this.parent(a)},options:{_point:new Jxl.Point,collideLeft:!0,collideRight:!0,collideTop:!0,collideBottom:!0,origin:new Jxl.Point,velocity:new Jxl.Point,acceleration:new Jxl.Point,_pZero:new Jxl.Point,drag:new Jxl.Point,maxVelocity:new Jxl.Point({x:1e4,y:1e4}),angle:0,angularVelocity:0,angularDrag:0,angularAcceleration:0,maxAngular:1e4,thrust:0,exists:!0,visible:!0,border:{visible:!1,thickness:2,color:new Color("#f00")},active:!0,solid:!0,fixed:!1,moves:!0,colHullMinus:new Jxl.Point,health:1,dead:!1,_flicker:!1,_flickerTimer:-1,scrollFactor:new Jxl.Point({x:1,y:1}),colHullX:new Jxl.Rect,colHullY:new Jxl.Rect,colVector:new Jxl.Point,colOffsets:[new Jxl.Point],_group:!1},refreshHulls:function(){var a=this.colHullMinus.x,b=this.colHullMinus.y;this.colHullX.x=this.x+a,this.colHullX.y=this.y+b,this.colHullX.width=this.width-a,this.colHullX.height=this.height-b,this.colHullY.x=this.x+a,this.colHullY.y=this.y+a,this.colHullY.width=this.width-a,this.colHullY.height=this.height-a},updateMotion:function(a){if(!!this.moves){this.solid&&this.refreshHulls(),this.onFloor=!1;var b=(Jxl.u.computeVelocity(a,this.angularVelocity,this.angularAcceleration,this.angularDrag,this.maxAngular)-this.angularVelocity)/2;this.angularVelocity+=b,this.angle+=this.angularVelocity*a,this.angularVelocity+=b;var c;if(this.thrust!=0){c=Jxl.u.rotatePoint(-this.thrust,0,0,0,this.angle);var d=Jxl.u.rotatePoint(-this.maxThrust,0,0,0,this.angle),e=Math.abs(d.x);e>Math.abs(d.y)?d.y=e:e=Math.abs(d.y),this.maxVelocity.x=this.maxVelocity.y=Math.abs(e)}else c=this._pZero;b=(Jxl.u.computeVelocity(a,this.velocity.x,this.acceleration.x+c.x,this.drag.x,this.maxVelocity.x)-this.velocity.x)/2,this.velocity.x+=b;var f=this.velocity.x*a;this.velocity.x+=b,b=(Jxl.u.computeVelocity(a,this.velocity.y,this.acceleration.y+c.y,this.drag.y,this.maxVelocity.y)-this.velocity.y)/2,this.velocity.y+=b;var g=this.velocity.y*a;this.velocity.y+=b,this.x+=f,this.y+=g;if(!this.solid)return;this.colVector.x=f,this.colVector.y=g,this.colHullX.width+=Math.abs(f),this.colVector.x<0&&(this.colHullX.x+=this.colVector.x),this.colHullY.x=this.x,this.colHullY.height+=Math.abs(this.colVector.y),this.colVector.y<0&&(this.colHullY.y+=this.colVector.y)}},updateFlickering:function(a){this.flickering()&&(this._flickerTimer>0&&(this._flickerTimer-=a,this._flickerTimer==0&&(this._flickerTimer=-1)),this._flickerTimer<0?this.flicker(-1):(this._flicker=!this._flicker,this.visible=!this._flicker))},update:function(a){this.updateMotion(a),this.updateFlickering(a)},flicker:function(a){a==undefined&&(a=1),this._flickerTimer=a,this._flickerTimer<0&&(this._flicker=!1,this.visible=!0)},reset:function(a,b){a==undefined&&(a=0),b==undefined&&(b=0),this.x=a,this.y=b,this.exists=!0,this.dead=!1},overlaps:function(a){this._point=this.getScreenXY(this._point);var b=this._point.x,c=this._point.y,d=this.width,e=this.height;if(this.isSprite!=undefined){var f=this;d=f.frameWidth,e=f.frameHeight}this._point=a.getScreenXY(this._point);var g=this._point.x,h=this._point.y,i=this.object.width,j=this.object.height;if(a.isSprite!=undefined){var k=a;i=k.frameWidth,j=k.frameHeight}return g<=b-i||g>=b+d||h<=c-j||h>=c+e?!1:!0},overlapsPoint:function(a,b,c,d){d==undefined&&(d=!1),b+=Math.floor(a.scroll.x),c+=Math.floor(a.scroll.y),this._point=this.getScreenXY(a,this._point);return b<=this._point.x||b>=this._point.x+this.width||c<=this._point.y||c>=this._point.y+this.height?!1:!0},collide:function(a){a==undefined&&(a=this);return Jxl.u.collide(this,a)},preCollide:function(a){},hitLeft:function(a,b){this.fixed||(this.velocity.x=b)},hitRight:function(a,b){this.hitLeft(a,b)},hitTop:function(a,b){this.fixed||(this.velocity.y=b)},hitBottom:function(a,b){this.onFloor=!0,this.fixed||(this.velocity.y=b)},flickering:function(){return this._flickerTimer>=0},hurt:function(a){(this.health-=a)<=0&&this.kill()},kill:function(){this.exists=!1,this.dead=!0},render:function(){this.border.visible&&(this._point=this.getScreenXY(this._point),this.renderBorder())},renderBorder:function(a){Jxl.buffer.strokeStyle=this.border.color,Jxl.buffer.lineWidth=this.border.thickness,Jxl.buffer.strokeRect(this._point.x-this.border.thickness,this._point.y-this.border.thickness,this.width+this.border.thickness,this.height+this.border.thickness)},getScreenXY:function(a){a==undefined&&(a=new Jxl.Point),a.x=Math.floor(this.x+Jxl.u.roundingError)+Math.floor(Jxl.scroll.x*this.scrollFactor.x),a.y=Math.floor(this.y+Jxl.u.roundingError)+Math.floor(Jxl.scroll.y*this.scrollFactor.y);return a}}),Jxl.Group=new Class({Extends:Jxl.Object,initialize:function(a){this.parent(Object.merge({},Jxl.Group.DEFAULTS,a))},add:function(a,b){b=b===undefined?!1:b,this.members.indexOf(a)<0&&(this.members[this.members.length]=a),b&&(a.scrollFactor=this.scrollFactor);return a},replace:function(a,b){var c=this.members.indexOf(a);if(c<0||c>=this.members.length)return null;this.members[c]=b;return b},remove:function(a,b){b=b===undefined?!1:b;var c=this.members.indexOf(a);if(c<0||c>=this.members.length)return null;b?this.members.splice(c,1):this.members[c]=null;return a},sort:function(a,b){a=a===undefined?"y":a,b=b===undefined?Jxl.Group.ASCENDING:b,this._sortIndex=a,this._sortOrder=b,this.members.sort(this.sortHandler)},getFirstAvail:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=undefined&&!b.exists)return b}return null},getFirstNull:function(){var a=0,b=this.members.length;while(a<b){if(this.members[a]==undefined)return a;a++}return-1},resetFirstAvail:function(a,b){a=a===undefined?0:a,b=b===undefined?0:b;var c=this.getFirstAvail();if(c==null)return!1;c.reset(a,b);return!0},getFirstExtant:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.exists)return b}return null},getFirstAlive:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.exists&&!b.dead)return b}return null},getFirstDead:function(){var a=0,b,c=this.members.length;while(a<c){b=this.members[a++];if(b!=null&&b.dead)return b}return null},countLiving:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.exists&&!c.dead&&a++);return a},countDead:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.dead&&a++);return a},countOnScreen:function(){var a=-1,b=0,c,d=this.members.length;while(b<d)c=this.members[b++],c!=null&&(a<0&&(a=0),c.onScreen()&&a++);return a},getRandom:function(){var a=0,b=null,c=this.members.length,d=Math.floor(Jxl.u.random()*c);while((b===null||b===undefined)&&a<this.members.length)b=this.members[++d%c],a++;return b},saveOldPosition:function(){this._first?(this._first=!1,this._last.x=0,this._last.y=0):(this._last.x=this.x,this._last.y=this.y)},updateMembers:function(a){var b,c,d=!1;if(this.x!=this._last.x||this.y!=this._last.y)d=!0,b=this.x-this._last.x,c=this.y-this._last.y;var e=0,f,g=this.members.length;while(e<g)f=this.members[e++],f!=null&&f.exists&&(d&&(f._group?f.reset(f.x+b,f.y+c):(f.x+=b,f.y+=c)),f.active&&f.update(a),d&&f.solid&&(f.colHullX.width+=b>0?b:-b,b<0&&(f.colHullX.x+=b),f.colHullY.x=this.x,f.colHullY.height+=c>0?c:-c,c<0&&(f.colHullY.y+=c),f.colVector.x+=b,f.colVector.y+=c))},update:function(a){this.saveOldPosition(),this.updateMotion(a),this.updateMembers(a),this.updateFlickering(a)},renderMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=this.members[a++],b!=null&&b.exists&&b.visible&&b.render()},render:function(){this.renderMembers()},killMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=this.members[a++],b!=null&&b.kill()},kill:function(){this.killMembers(),this.parent()},destroyMembers:function(){var a=0,b,c=this.members.length;while(a<c)b=members[a++],b!=null&&b.destroy();this.members.length=0},destroy:function(){this.destroyMembers(),this.parent()},reset:function(a,b){this.saveOldPosition(),this.parent(a,b);var c,d,e=!1;if(this.x!=this._last.x||this.y!=this._last.y)e=!0,c=this.x-this._last.x,d=this.y-this._last.y;var f=0,g,h=this.members.length;while(f<h)g=members[f++],g!=null&&g.exists&&e&&(g._group?g.reset(g.x+c,g.y+d):(g.x+=c,g.y+=d,this.solid&&(g.colHullX.width+=c>0?c:-c,c<0&&(g.colHullX.x+=c),g.colHullY.x=this.x,g.colHullY.height+=d>0?d:-d,d<0&&(g.colHullY.y+=d),g.colVector.x+=c,g.colVector.y+=d)))},sortHandler:function(a,b){if(a[this._sortIndex]<b[this._sortIndex])return this._sortOrder;if(a[this._sortIndex]>b[this._sortIndex])return-this._sortOrder;return 0}}),Jxl.Group.ASCENDING=-1,Jxl.Group.DESCENDING=1,Jxl.Group.DEFAULTS={_group:!0,solid:!1,members:[],_last:new Jxl.Point,_first:!0},Jxl.State=new Class({Implements:[Options],initialize:function(a){this.setOptions(a),Object.merge(this,this.options),this.create()},options:{defaultGroup:new Jxl.Group},create:function(){},add:function(a){return this.defaultGroup.add(a)},remove:function(a){this.defaultGroup.remove(a)},preProcess:function(){Jxl.buffer.clearRect(0,0,Jxl.screenWidth(),Jxl.screenHeight())},update:function(a){this.defaultGroup.update(a)},collide:function(){Jxl.u.collide(this.defaultGroup,this.defaultGroup)},render:function(){this.defaultGroup.render()},postProcess:function(){},destroy:function(){this.defaultGroup.destroy()}}),Jxl.Sprite=new Class({Extends:Jxl.Object,initialize:function(a){this.parent(a),this.buffer=new Element("canvas",{width:this.width,height:this.height}),this.bufferCTX=this.buffer.getContext("2d"),this.bufferCTX.drawImage(this.graphic,0,0,this.width,this.height,0,0,this.width,this.height),this.resetHelpers(),document.body.grab(this.buffer)},options:{isSprite:!0,angle:0,_alpha:1,_color:16777215,_blend:null,scale:new Jxl.Point({x:1,y:1}),_facing:1,_animations:{},_flipped:0,_curFrame:0,_frameTimer:0,finished:!1,_caf:0,offset:new Jxl.Point,_curAnim:null,animated:!1,graphic:new Element("canvas")},play:function(a,b){b==undefined&&(b=!1);if(!!b||this._curAnim==null||a!=this._curAnim.name)this._curFrame=0,this._caf=0,this._curAnim=this._animations[a],this._curFrame=this._curAnim.frames[this._caf]},flip:function(){this.bufferCTX.scale(-1,1),this.bufferCTX.translate(-this.width,0)},calcFrame:function(){this.bufferCTX.clearRect(0,0,this.width,this.height);var a=this._curFrame*this.width,b=0;a>this.graphic.width&&(b=Math.floor(a/this.graphic.width)*this.height,a=a%this.graphic.width),this._flipped&&this.flip(),this.bufferCTX.drawImage(this.graphic,a,b,this.width,this.height,0,0,this.width,this.height)},render:function(){if(!!this.visible){this.buffer.width=this.width,this.animated&&this.calcFrame();var a=this.buffer;this._point=this.getScreenXY(this._point),(this.border.visible||Jxl.showBB)&&this.renderBorder(this._point),Jxl.buffer.drawImage(a,0,0,this.width,this.height,this._point.x,this._point.y,this.width,this.height)}},onEmit:function(){},updateAnimation:function(a){this._curAnim!=null&&this._curAnim.delay>0&&(this._curAnim.looped||!this.finished)&&(this._frameTimer+=a,this._frameTimer>this._curAnim.delay&&(this._frameTimer-=this._curAnim.delay,this._caf==this._curAnim.frames.length-1?(this._curAnim.looped&&(this._caf=0),this.finished=!0,this.animationComplete(this._curAnim.name,this._curAnim.looped)):this._caf++,this._curFrame=this._curAnim.frames[this._caf]))},animationComplete:function(a,b){},addAnimation:function(a,b,c,d){c==undefined&&(c=0),d==undefined&&(d=!0),this._animations[a]=new Jxl.Anim(a,b,c,d)},update:function(a,b){this.updateMotion(a,b),this.updateAnimation(a,b),this.updateFlickering(a,b)},getScreenXY:function(a){a==undefined&&(a=new Jxl.Point),a.x=Math.floor(this.x+Jxl.u.roundingError)+Math.floor(Jxl.scroll.x*this.scrollFactor.x)-this.offset.x,a.y=Math.floor(this.y+Jxl.u.roundingError)+Math.floor(Jxl.scroll.y*this.scrollFactor.y)-this.offset.y;return a},overlapsPoint:function(a,b,c,d){d==undefined&&(d=!1),b-=Math.floor(a.scroll.x),c-=Math.floor(a.scroll.y),this._point=this.getScreenXY(a,this._point);return b<=this._point.x||b>=this._point.x+this.width||c<=this._point.y||c>=this._point.y+this.height?!1:!0},getFacing:function(){return this._facing},setFacing:function(a){var b=this._facing!=a;this._facing=a,b&&this.calcFrame()},resetHelpers:function(){this._boundsVisible=!1,this.origin.x=this.width*.5,this.origin.y=this.height*.5,this.graphic&&(this.frames=Math.floor(this.graphic.width/this.width*this.graphic.height/this.height)),this._caf=0,this.refreshHulls(),this._graphicCTX=this.graphic.getContext("2d")},createGraphic:function(a,b,c){c=c==undefined?4294967295:c,this.graphic=document.createElement("canvas");var d=this.graphic.getContext("2d");this.width=this.graphic.width=this.frameWidth=a,this.height=this.graphic.height=this.frameHeight=b,d.fillStyle=Jxl.u.makeRGBA(c),d.fillRect(0,0,a,b),this.resetHelpers();return this}}),Jxl.Sprite.LEFT=0,Jxl.Sprite.RIGHT=1,Jxl.Sprite.UP=2,Jxl.Sprite.DOWN=3,Jxl.Anim=new Class({initialize:function(a,b,c,d){this.name=a,this.delay=0,c>0&&(this.delay=c),this.frames=b,this.looped=d}}),Jxl.TileMap=new Class({Extends:Jxl.Object,initialize:function(a){this.parent(a)},options:{auto:Jxl.TileMapOFF,collideIndex:1,startingIndex:0,drawIndex:1,widthInTiles:0,heightInTiles:0,totalTiles:0,_buffer:null,_bufferLoc:new Jxl.Point,_flashRect2:new Jxl.Rect,_flashRect:new Jxl.Rect,_data:null,_tileWidth:0,_tileHeight:0,_rects:null,_pixels:null,_block:new Jxl.Object({width:0,height:0,fixed:!0}),_callbacks:[],fixed:!0},loadMap:function(a,b,c,d){var e,f,g=a.split("\n");this.heightInTiles=g.length,this._data=[];for(var h=0;h<this.heightInTiles;h++){f=g[h].split(",");if(f.length<=1){this.heightInTiles--;continue}this.widthInTiles==0&&(this.widthInTiles=f.length);for(e=0;e<this.widthInTiles;e++)this._data.push(f[e])}var i;this.totalTiles=this.widthInTiles*this.heightInTiles;if(this.auto>Jxl.TileMapOFF){this.collideIndex=this.startingIndex=this.drawIndex=1,i=0;while(i<this.totalTiles)this.autoTile(i++)}this._pixels=b,c==undefined?this._tileWidth=this._pixels.height:this._tileWidth=c,d==undefined?this._tileHeight=this._tileWidth:this._tileHeight=d,this._block.width=this._tileWidth,this._block.height=this._tileHeight,this.width=this.widthInTiles*this._tileWidth,this.height=this.heightInTiles*this._tileHeight,this._rects=Array(this.totalTiles);for(i=0;i<this.totalTiles;i++)this.updateTile(i);this._screenRows=Math.ceil(Jxl.height/this._tileHeight)+1,this._screenRows>this.heightInTiles&&(this._screenRows=this.heightInTiles),this._screenCols=Math.ceil(Jxl.width/this._tileWidth)+1,this._screenCols>this.widthInTiles&&(this._screenCols=this.widthInTiles);return this},render:function(){this._point=this.getScreenXY(Jxl,this._point);var a=new Jxl.Point({x:this._point.x,y:this._point.y}),b=Math.floor(-this._point.x/this._tileWidth),c=Math.floor(-this._point.y/this._tileHeight);b<0&&(b=0),b>this.widthInTiles-this._screenCols&&(b=this.widthInTiles-this._screenCols),c<0&&(c=0),c>this.heightInTiles-this._screenRows&&(c=this.heightInTiles-this._screenRows);var d=c*this.widthInTiles+b;a.x+=b*this._tileWidth,a.y+=c*this._tileHeight;var e=a.x,f,g;for(var h=0;h<this._screenRows;h++){g=d;for(f=0;f<this._screenCols;f++){var i=this._rects[g++];i!=null&&Jxl.buffer.drawImage(this._pixels,i[0],i[1],i[2],i[3],a.x,a.y,this._tileWidth,this._tileHeight),a.x+=this._tileWidth}d+=this.widthInTiles,a.x=e,a.y+=this._tileHeight}},updateTile:function(a){if(this._data[a]<this.drawIndex)this._rects[a]=null;else{var b=(this._data[a]-this.startingIndex)*this._tileWidth,c=0;b>=this._pixels.width&&(c=Math.floor(Math.abs(b/this._pixels.width))*this._tileHeight,b=b%this._pixels.width),this._rects[a]=[b,c,this._tileWidth,this._tileHeight]}},autoTile:function(a){if(this._data[a]!=0){this._data[a]=0;if(a-this.widthInTiles<0||this._data[a-this.widthInTiles]>0)this._data[a]+=1;if(a%this.widthInTiles>=this.widthInTiles-1||this._data[a+1]>0)this._data[a]+=2;if(a+this.widthInTiles>=this.totalTiles||this._data[a+this.widthInTiles]>0)this._data[a]+=4;if(a%this.widthInTiles<=0||this._data[a-1]>0)this._data[a]+=8;this.auto==Jxl.TileMapALT&&this._data[a]==15&&(a%this.widthInTiles>0&&a+this.widthInTiles<this.totalTiles&&this._data[a+this.widthInTiles-1]<=0&&(this._data[a]=1),a%this.widthInTiles>0&&a-this.widthInTiles>=0&&this._data[a-this.widthInTiles-1]<=0&&(this._data[a]=2),a%this.widthInTiles<this.widthInTiles-1&&a-this.widthInTiles>=0&&this._data[a-this.widthInTiles+1]<=0&&(this._data[a]=4),a%this.widthInTiles<this.widthInTiles-1&&a+this.widthInTiles<this.totalTiles&&this._data[a+this.widthInTiles+1]<=0&&(this._data[a]=8)),this._data[a]+=1}},overlaps:function(a){var b,c,d=[],e=Math.floor((a.x-this.x)/this._tileWidth),f=Math.floor((a.y-this.y)/this._tileHeight),g=Math.ceil(a.width/this._tileWidth)+1,h=Math.ceil(a.height/this._tileHeight)+1,i=0,j;while(i<h){if(i>=this.heightInTiles)break;b=(f+i)*this.widthInTiles+e,j=0;while(j<g){if(j>=this.widthInTiles)break;c=Math.floor(this._data[b+j]),c>=this.collideIndex&&d.push({x:this.x+(e+j)*this._tileWidth,y:this.y+(f+i)*this._tileHeight,data:c}),j++}i++}var k=d.length,l=!1,m=0;while(m<k){this._block.x=d[m].x,this._block.y=d[m++].y;if(this._block.overlaps(a))return!0}return!1},renderTileBB:function(a,b){a>=this.widthInTiles||b>=this.heightInTiles||(Jxl.buffer.strokeStyle=this.border.color,Jxl.buffer.lineWidth=this.border.thickness,Jxl.buffer.strokeRect(this._point.x-this.border.thickness+a*this.tileWidth,this._point.y-this.border.thickness+b*this.tileHeight,this.tileWidth+this.border.thickness,this.tileHeight+this.border.thickness))},setTile:function(a,b,c,d){d=d===undefined?!0:d;return a>=this.widthInTiles||b>=this.heightInTiles?!1:this.setTileByIndex(b*this.widthInTiles+a,c,d)},setTileByIndex:function(a,b,c){c=c===undefined?!0:c;if(a>=this._data.length)return!1;var d=!0;this._data[a]=b;if(!c)return d;this.refresh=!0;if(this.auto==Jxl.TilemapOFF){this.updateTile(a);return d}var e,f=Math.floor(a/this.widthInTiles)-1,g=f+3,h=a%this.widthInTiles-1,i=h+3;while(f<g){h=i-3;while(h<i)f>=0&&f<this.heightInTiles&&h>=0&&h<this.widthInTiles&&(e=f*this.widthInTiles+h,this.autoTile(e),this.updateTile(e)),h++;f++}return d},overlapsPoint:function(a,b,c){var d=getTile(Math.floor((a-this.x)/this._tileWidth),Math.floor((b-this.y)/this._tileHeight));return d>=this.collideIndex},refreshHulls:function(){this.colHullX.x=0,this.colHullX.y=0,this.colHullX.width=this._tileWidth,this.colHullX.height=this._tileHeight,this.colHullY.x=0,this.colHullY.y=0,this.colHullY.width=this._tileWidth,this.colHullY.height=this._tileHeight},preCollide:function(a){var b,c,d,e=0,f=Math.floor((a.x-this.x)/this._tileWidth),g=Math.floor((a.y-this.y)/this._tileHeight),h=f+Math.ceil(a.width/this._tileWidth+1),i=g+Math.ceil(a.height/this._tileHeight+1);f<0&&(f=0),g<0&&(g=0),h>this.widthInTiles&&(h=this.widthInTiles),i>this.heightInTiles&&(i=this.heightInTiles),d=g*this.widthInTiles,b=g;for(b=g;b<i;b++){for(c=f;c<h;c++)Math.floor(Math.abs(this._data[d+c]))>=this.collideIndex&&(this.colOffsets[e++]=new Jxl.Point({x:this.x+c*this._tileWidth,y:this.y+b*this._tileHeight}));d+=this.widthInTiles}this.colOffsets.length!=e&&(this.colOffsets.length=e)},ray:function(a,b,c,d,e,f){f=f===undefined?1:f;var g=this._tileWidth;this._tileHeight<this._tileWidth&&(g=this._tileHeight),g/=f;var h=c-a,i=d-b,j=Math.sqrt(h*h+i*i),k=Math.ceil(j/g),l=h/k,m=i/k,n=a-l,o=b-m,p,q,r=0;while(r<k){n+=l,o+=m;if(n<0||n>width||o<0||o>height){r++;continue}p=n/this._tileWidth,q=o/this._tileHeight;if(Math.floor(this._data[q*this.widthInTiles+p])>=this.collideIndex){p*=this._tileWidth,q*=this._tileHeight;var s=0,t=0,u,v=n-l,w=o-m;u=p,h<0&&(u+=this._tileWidth),s=u,t=w+m*((u-v)/l);if(t>q&&t<q+this._tileHeight){e===undefined&&(e=new Jxl.Point),e.x=s,e.y=t;return!0}u=q,i<0&&(u+=this._tileHeight),s=v+l*((u-w)/m),t=u;if(s>p&&s<p+this._tileWidth){e===undefined&&(e=new Jxl.Point),e.x=s,e.y=t;return!0}return!1}r++}return!1}}),Jxl.TileMapOFF=0,Jxl.TileMapAUTO=1,Jxl.TileMapALT=2,Jxl.TileMap.arrayToCSV=function(a,b){var c=0,d,e="",f=a.length/b;while(c<f){d=0;while(d<b)d==0?c==0?e+=a[0]:e+="\n"+a[c*b]:e+=", "+a[c*b+d],d++;c++}return e};var AudioManager=new Class({initialize:function(){this.sounds={},this.channels=[];for(var a=0;a<16;a++)this.channels[a]=document.createElement("audio"),this.channels[a].dead=!0},play:function(a,b,c,d,e){if(a in this.sounds)for(var f=0;f<this.channels.length;f++)if(this.channels[f].dead){this.channels[f].dead=!1,this.channels[f].src=this.sounds[a].src,this.channels[f].start=0,this.channels[f].finish=this.sounds[a].duration,e?this.channels[f].volume=e:this.channels[f].volume=1,b?this.channels[f].loop=!0:this.channels[f].loop=!1,c&&(this.channels[f].currentTime=c,this.channels[f].start=c),d&&(this.channels[f].finish=d),this.channels[f].play();return}},unpause:function(){for(var a=0;a<this.channels.length;a++)this.channels[a].dead||this.channels[a].play()},pause:function(){for(var a=0;a<this.channels.length;a++)this.channels[a].dead||this.channels[a].pause()},update:function(a){var b=this.channels.length-1;while(b>=0)!this.channels[b].paused&&this.channels[b].currentTime>=this.channels[b].finish&&(this.channels[b].loop?this.channels[b].currentTime=this.channels[b].start:(this.channels[b].dead=!0,this.channels[b].pause())),b--},add:function(a,b){this.sounds[a]=b}});Jxl.audio=new AudioManager;var AssetManager=new Class({initialize:function(){this.assets={},this.batches=[]},get:function(a){return this.assets[a]},reload:function(a){var b=this,c=this.batches.length,d=0;Array.each(this.batches,function(e){b.load(e,function(){d++,a!=undefined&&c==d&&a()})})},load:function(a,b,c){this.batches.push(a);var d=this,e=Object.getLength(a),f=0;Object.each(a,function(a,c){d.loadAsset(a[0],c,a[1],function(a){d.assets[c]=a,f++,b!=undefined&&f>=e&&b()})})},loadAsset:function(a,b,c,d){var e=this;if(b in this.assets)d&&d();else switch(a){case"audio":case"sound":var f=new Audio(c);f.src=c,f.load(),this.assets[b]=f,e.game.audio.add(b,f),d&&d(f);break;case"image":var f=document.createElement("img");f.src=c,this.assets[b]=f,f.addEvent("load",function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var b=a.getContext("2d");b.drawImage(this,0,0),d&&d(a)})}}});Jxl.loader=new AssetManager,Jxl.List=new Class({initialize:function(){this.object=null,this.next=null}}),Jxl.QuadTree=new Class({Extends:Jxl.Rect,initialize:function(a,b,c,d,e){this.parent(a,b,c,d),this._headA=this._tailA=new Jxl.List,this._headB=this._tailB=new Jxl.List;if(e!=undefined){var f,g;if(e._headA.object!=null){f=e._headA;while(f!=null)this._tailA.object!=null&&(g=this._tailA,this._tailA=new Jxl.List,g.next=this._tailA),this.tailA.object=f.object,f=f.next}if(e._headB.object!=null){f=e._headB;while(f!=null)this._tailB.object!=null&&(g=this._tailB,this._tailB=new Jxl.List,g.next=this._tailB),this._tailB.object=f.object,f=f.next}}else this._min=(this.width+this.height)/(2*Jxl.u.quadTreeDivisions);this._canSubdivide=this.width>this._min||this.height>Jxl.QuadTree._min,this._nw=null,this._ne=null,this._se=null,this._sw=null,this._l=this.x,this._r=this.x+this.width,this._hw=this.width/2,this._mx=this._l+this._hw,this._t=this.y,this._b=this.y+this.height,this._hh=this.height/2,this._my=this._t+this._hh},add:function(a,b){Jxl.QuadTree._oa=b;if(a._group){var c,d=a.members,e=d.length;for(var f=0;f<e;f++)c=d[f],c!==null&&c.exists&&(c._group?this.add(c,b):c.solid&&(Jxl.QuadTree._o=c,Jxl.QuadTree._ol=Jxl.QuadTree._o.x,Jxl.QuadTree._ot=Jxl.QuadTree._o.y,Jxl.QuadTree._or=Jxl.QuadTree._o.x+Jxl.QuadTree._o.width,Jxl.QuadTree._ob=Jxl.QuadTree._o.y+Jxl.QuadTree._o.height,this.addObject()))}a.solid&&(Jxl.QuadTree._o=a,Jxl.QuadTree._ol=Jxl.QuadTree._o.x,Jxl.QuadTree._ot=Jxl.QuadTree._o.y,Jxl.QuadTree._or=Jxl.QuadTree._o.x+Jxl.QuadTree._o.width,Jxl.QuadTree._ob=Jxl.QuadTree._o.y+Jxl.QuadTree._o.height,this.addObject())},addObject:function(){if(!this._canSubdivide||this._l>=Jxl.QuadTree._ol&&this._r<=Jxl.QuadTree._or&&this._t>=Jxl.QuadTree._ot&&this._b<=Jxl.QuadTree._ob)this.addToList();else{if(Jxl.QuadTree._ol>this._l&&Jxl.QuadTree._or<this._mx){if(Jxl.QuadTree._ot>this._t&&Jxl.QuadTree._ob<this._my){this._nw===null&&(this._nw=new Jxl.QuadTree(this._l,this._t,this._hw,this._hh,this)),this._nw.addObject();return}if(Jxl.QuadTree._ot>this._my&&Jxl.QuadTree._ob<this._b){this._sw===null&&(this._sw=new Jxl.QuadTree(this._l,this._my,this._hw,this._hh,this)),this._sw.addObject();return}}if(Jxl.QuadTree._ol>this._mx&&Jxl.QuadTree._or<this._r){if(Jxl.QuadTree._ot>this._t&&Jxl.QuadTree._ob<this._my){this._ne===null&&(this._ne=new Jxl.QuadTree(this._mx,this._t,this._hw,this._hh,this)),this._ne.addObject();return}if(Jxl.QuadTree._ot>this._my&&Jxl.QuadTree._ob<this._b){this._se===null&&(this._se=new Jxl.QuadTree(this._mx,this._my,this._hw,this._hh,this)),this._se.addObject();return}}Jxl.QuadTree._or>this._l&&Jxl.QuadTree._ol<this._mx&&Jxl.QuadTree._ob>this._t&&Jxl.QuadTree._ot<this._my&&(this._nw===null&&(this._nw=new Jxl.QuadTree(this._l,this._t,this._hw,this._hh,this)),this._nw.addObject()),Jxl.QuadTree._or>this._mx&&Jxl.QuadTree._ol<this._r&&Jxl.QuadTree._ob>this._t&&Jxl.QuadTree._ot<this._my&&(this._ne===null&&(this._ne=new Jxl.QuadTree(this._mx,this._t,this._hw,this._hh,this)),this._ne.addObject()),Jxl.QuadTree._or>this._mx&&Jxl.QuadTree._ol<this._r&&Jxl.QuadTree._ob>this._my&&Jxl.QuadTree._ot<this._b&&(this._se===null&&(this._se=new Jxl.QuadTree(this._mx,this._my,this._hw,this._hh,this)),this._se.addObject()),Jxl.QuadTree._or>this._l&&Jxl.QuadTree._ol<this._mx&&Jxl.QuadTree._ob>this._my&&Jxl.QuadTree._ot<this._b&&(this._sw===null&&(this._sw=new Jxl.QuadTree(this._l,this._my,this._hw,this._hh,this)),this._sw.addObject())}},addToList:function(){var a;Jxl.QuadTree._oa==Jxl.QuadTree.A_LIST?(this._tailA.object!==null&&(a=this._tailA,this._tailA=new Jxl.List,a.next=this._tailA),this._tailA.object=Jxl.QuadTree._o):(this._tailB.object!==null&&(a=this._tailB,this._tailB=new Jxl.List,a.next=this._tailB),this._tailB.object=Jxl.QuadTree._o);!this._canSubdivide||(this._nw!==null&&this._nw.addToList(),this._ne!==null&&this._ne.addToList(),this._se!==null&&this._se.addToList(),this._sw!==null&&this._sw.addToList())},overlap:function(a,b){a=a===undefined?!0:a,b=b===undefined?null:b,Jxl.QuadTree._oc=b;var c=!1,d;if(a){Jxl.QuadTree._oa=Jxl.QuadTree.B_LIST;if(this._headA.object!==null){d=this._headA;while(d!==null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&this.overlapNode()&&(c=!0),d=d.next}Jxl.QuadTree._oa=Jxl.QuadTree.A_LIST;if(this._headB.object!==null){d=this._headB;while(d!==null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&(this._nw!==null&&this._nw.overlapNode()&&(c=!0),this._ne!==null&&this._ne.overlapNode()&&(c=!0),this._se!==null&&this._se.overlapNode()&&(c=!0),this._sw!==null&&this._sw.overlapNode()&&(c=!0)),d=d.next}}else if(this._headA.object!==null){d=this._headA;while(d!=null)Jxl.QuadTree._o=d.object,Jxl.QuadTree._o.exists&&Jxl.QuadTree._o.solid&&this.overlapNode(d.next)&&(c=!0),d=d.next}this._nw!=null&&this._nw.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._ne!=null&&this._ne.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._se!=null&&this._se.overlap(a,Jxl.QuadTree._oc)&&(c=!0),this._sw!=null&&this._sw.overlap(a,Jxl.QuadTree._oc)&&(c=!0);return c},overlapNode:function(a){a=a===undefined?null:a;var b=!1,c,d=a;d==null&&(this._oa==Jxl.QuadTree.A_LIST?d=this._headA:d=this._headB);if(d.object!=null)while(d!=null){c=d.object;if(Jxl.QuadTree._o===c||!c.exists||!Jxl.QuadTree._o.exists||!c.solid||!Jxl.QuadTree._o.solid||Jxl.QuadTree._o.x+Jxl.QuadTree._o.width<c.x+Jxl.u.roundingError||Jxl.QuadTree._o.x+Jxl.u.roundingError>c.x+c.width||Jxl.QuadTree._o.y+Jxl.QuadTree._o.height<c.y+Jxl.u.roundingError||Jxl.QuadTree._o.y+Jxl.u.roundingError>c.y+c.height){d=d.next;continue}Jxl.QuadTree._oc==null?(Jxl.QuadTree._o.kill(),c.kill(),b=!0):Jxl.QuadTree._oc(Jxl.QuadTree._o,c)&&(b=!0),d=d.next}return b}}),Jxl.QuadTree.A_LIST=0,Jxl.QuadTree.B_LIST=1,Jxl.QuadTree.divisions=3,Jxl.QuadTree.quadTree=null,Jxl.QuadTree.bounds=null,Jxl.Util=new Class({initialize:function(){this.roundingError=1e-7,this.quadTreeDivisions=3},random:function(a){if(a==undefined||a===undefined)return Math.random();a==0&&(a=Number.MIN_VALUE),a>=1?(a%1==0&&(a/=Math.PI),a%=1):a<0&&(a=a%1+1);return 69621*Math.floor(a*2147483647)%2147483647/2147483647},overlap:function(a,b,c){if(a==null||!a.exists||b==null||!b.exists)return!1;quadTree=new Jxl.QuadTree(Jxl.QuadTree.bounds.x,Jxl.QuadTree.bounds.y,Jxl.QuadTree.bounds.width,Jxl.QuadTree.bounds.height),quadTree.add(a,Jxl.QuadTree.A_LIST);if(a===b)return quadTree.overlap(!1,c);quadTree.add(b,Jxl.QuadTree.B_LIST);return quadTree.overlap(!0,c)},makeRGBA:function(a){var b=a.toString(16),c=parseInt(b.substr(0,2),16)/255,d=parseInt(b.substr(2,2),16),e=parseInt(b.substr(4,2),16),f=parseInt(b.substr(6,2),16);return"rgba("+d+","+e+","+f+","+c+")"},collide:function(a,b){if(a==null||!a.exists||b==null||!b.exists)return!1;quadTree=new Jxl.QuadTree(Jxl.QuadTree.bounds.x,Jxl.QuadTree.bounds.y,Jxl.QuadTree.bounds.width,Jxl.QuadTree.bounds.height),quadTree.add(a,Jxl.QuadTree.A_LIST);var c=a===b;c||quadTree.add(b,Jxl.QuadTree.B_LIST);var d=quadTree.overlap(!c,Jxl.u.solveXCollision),e=quadTree.overlap(!c,Jxl.u.solveYCollision);return d||e},rotatePoint:function(a,b,c,d,e,f){f==undefined&&(f=new JxlPoint);var g=-e/180*Math.PI,h=a-c,i=d-b;f.x=c+Math.cos(g)*h-Math.sin(g)*i,f.y=d-(Math.sin(g)*h+Math.cos(g)*i);return f},solveXCollision:function(a,b){var c=a.colVector.x,d=b.colVector.x;if(c==d)return!1;a.preCollide(b),b.preCollide(a);var e,f,g,h=!1,i,j=c==0,k=c<0,l=c>0,m=d==0,n=d<0,o=d>0,p,q,r=a.colHullX,s=b.colHullX,t=a.colOffsets,u=b.colOffsets,v=t.length,w=u.length,x,y,z,A,B,C,D,E;i=j&&n||l&&m||l&&n||k&&n&&(c>0?c:-c)<(d>0?d:-d)||l&&o&&(c>0?c:-c)>(d>0?d:-d);if(i?!a.collideRight||!b.collideLeft:!a.collideLeft||!b.collideRight)return!1;for(p=0;p<v;p++){x=t[p].x,y=t[p].y,r.x+=x,r.y+=y;for(q=0;q<w;q++){z=u[q].x,A=u[q].y,s.x+=z,s.y+=A;if(r.x+r.width<s.x+Jxl.u.roundingError||r.x+Jxl.u.roundingError>s.x+s.width||r.y+r.height<s.y+Jxl.u.roundingError||r.y+Jxl.u.roundingError>s.y+s.height){s.x-=z,s.y-=A;continue}i?(k?B=r.x+a.colHullY.width:B=r.x+r.width,n?C=s.x:C=s.x+s.width-b.colHullY.width):(n?B=-s.x-b.colHullY.width:B=-s.x-s.width,k?C=-r.x:C=-r.x-r.width+a.colHullY.width),g=B-C;if(g==0||!a.fixed&&(g>0?g:-g)>r.width*.8||!b.fixed&&(g>0?g:-g)>s.width*.8){s.x-=z,s.y-=A;continue}h=!0,D=b.velocity.x,E=a.velocity.x,!a.fixed&&b.fixed?a._group?a.reset(a.x-g,a.y):a.x-=g:a.fixed&&!b.fixed?b._group?b.reset(b.x+g,b.y):b.x+=g:!a.fixed&&!b.fixed&&(g/=2,a._group?a.reset(a.x-g,a.y):a.x-=g,b._group?b.reset(b.x+g,b.y):b.x+=g,D/=2,E/=2),i?(a.hitRight(b,D),b.hitLeft(a,E)):(a.hitLeft(b,D),b.hitRight(a,E)),!a.fixed&&g!=0&&(i?r.width-=g:(r.x-=g,r.width+=g),a.colHullY.x-=g),!b.fixed&&g!=0&&(i?(s.x+=g,s.width-=g):s.width+=g,b.colHullY.x+=g),s.x-=z,s.y-=A}r.x-=x,r.y-=y}return h},solveYCollision:function(a,b){var c=a.colVector.y,d=b.colVector.y;if(c==d)return!1;a.preCollide(b),b.preCollide(a);var e,f=!1,g,h=c==0,i=c<0,j=c>0,k=d==0,l=d<0,m=d>0,n,o,p=a.colHullY,q=b.colHullY,r=a.colOffsets,s=b.colOffsets,t=r.length,u=s.length,v,w,x,y,z,A,B,C;g=h&&l||j&&k||j&&l||i&&l&&(c>0?c:-c)<(d>0?d:-d)||j&&m&&(c>0?c:-c)>(d>0?d:-d);if(g?!a.collideBottom||!b.collideTop:!a.collideTop||!b.collideBottom)return!1;for(n=0;n<t;n++){v=r[n].x,w=r[n].y,p.x+=v,p.y+=w;for(o=0;o<u;o++){x=s[o].x,y=s[o].y,q.x+=x,q.y+=y;if(p.x+p.width<q.x+Jxl.u.roundingError||p.x+Jxl.u.roundingError>q.x+q.width||p.y+p.height<q.y+Jxl.u.roundingError||p.y+Jxl.u.roundingError>q.y+q.height){q.x-=x,q.y-=y;continue}g?(i?z=p.y+a.colHullX.height:z=p.y+p.height,l?A=q.y:A=q.y+q.height-b.colHullX.height):(l?z=-q.y-b.colHullX.height:z=-q.y-q.height,i?A=-p.y:A=-p.y-p.height+a.colHullX.height),e=z-A;if(e==0||!a.fixed&&(e>0?e:-e)>p.height*.8||!b.fixed&&(e>0?e:-e)>q.height*.8){q.x-=x,q.y-=y;continue}f=!0,B=b.velocity.y,C=a.velocity.y,!a.fixed&&b.fixed?a._group?a.reset(a.x,a.y-e):a.y-=e:a.fixed&&!b.fixed?b._group?b.reset(b.x,b.y+e):b.y+=e:!a.fixed&&!b.fixed&&(e/=2,a._group?a.reset(a.x,a.y-e):a.y-=e,b._group?b.reset(b.x,b.y+e):b.y+=e,B/=2,C/=2),g?(a.hitBottom(b,B),b.hitTop(a,C)):(a.hitTop(b,B),b.hitBottom(a,C)),!a.fixed&&e!=0&&(g?(p.y-=e,b.fixed&&b.moves&&(B=b.colVector.x,a.x+=B,p.x+=B,a.colHullX.x+=B)):(p.y-=e,p.height+=e)),!b.fixed&&e!=0&&(g?(q.y+=e,q.height-=e):(q.height+=e,a.fixed&&a.moves&&(C=a.colVector.x,b.x+=C,q.x+=C,b.colHullX.x+=C))),q.x-=x,q.y-=y}p.x-=v,p.y-=w}return f},getAngle:function(a,b){return Math.atan2(b,a)*180/Math.PI},computeVelocity:function(a,b,c,d,e){c==undefined&&(c=0),d==undefined&&(d=0),e==undefined&&(e=1e4);if(c!=0)b+=c*a;else if(d!=0){var f=d*a;b-f>0?b-=f:b+f<0?b+=f:b=0}b!=0&&e!=1e4&&(b>e?b=e:b<-e&&(b=-e));return b},setWorldBounds:function(a,b,c,d,e){a=a==undefined?0:a,b=b==undefined?0:b,c=c==undefined?0:c,d=d==undefined?0:d,e=e==undefined?3:e,Jxl.QuadTree.bounds==null&&(Jxl.QuadTree.bounds=new Jxl.Rect),Jxl.QuadTree.bounds.x=a,Jxl.QuadTree.bounds.y=b,c>0&&(Jxl.QuadTree.bounds.width=c),d>0&&(Jxl.QuadTree.bounds.height=d),e>0&&(Jxl.QuadTree.divisions=e)}}),Jxl.u=new Jxl.Util,Jxl.UI={},Jxl.UI.Object=new Class({Implements:[Options],initialize:function(a){this.setOptions(a),Object.merge(this,this.options)},rendered:!1,render:function(a){this.rendered=!0;var b=this;this.html=new Element("div",this.attr),Object.each(this.members,function(a,c){b.html.grab(a.render().html.set("id",c))}),a!==undefined&&a.grab(this.html);return this},destroy:function(){this.rendered=!1,this.html.dispose()}}),Jxl.UI.Dialog=new Class({Extends:Jxl.UI.Object,render:function(a){this.parent(),this.html.set("class","jxDialog"),this.modal===!0&&(this.html=(new Element("div",{"class":"jxModal"})).grab(this.html)),a!==undefined&&a.grab(this.html);return this}}),Jxl.UI.Button=new Class({Extends:Jxl.UI.Object,attr:{"class":"jxButton"}}),Jxl.UI.pause=new Jxl.UI.Dialog({attr:{id:"pauseMenu",html:"Jixel is Paused"},members:{unpause:new Jxl.UI.Button({attr:{html:"Resume!",events:{click:function(){Jxl.unpause()}}}})},modal:!0}),Jxl.UI.fps=new Jxl.UI.Object({attr:{styles:{fontWeight:"bold",position:"fixed",top:"0px",right:"0px"}}}),Jxl.Mouse=new Class({Extends:Jxl.Object,initialize:function(){this.parent();var a=this;Jxl.canvas.addEvent("mousemove",function(b){a.x=b.event.x/Jxl.scale,a.y=b.event.y/Jxl.scale})},options:{scrollFactor:new Jxl.Point({x:0,y:0}),width:1,height:1}})